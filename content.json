[{"title":"Kotlin coroutines on Android","date":"2021-02-19T07:19:42.000Z","path":"2021/02/19/Kotlin-coroutines-on-Android/","text":"What is coroutines?ç»´åŸºç™¾ç§‘çš„å®šä¹‰ç»´åŸºç™¾ç§‘ä¸Šå¯¹åç¨‹çš„å®šä¹‰ï¼š 1åç¨‹æ˜¯è®¡ç®—æœºç¨‹åºçš„ä¸€ç±»ç»„ä»¶ï¼Œæ¨å¹¿äº†åä½œå¼å¤šä»»åŠ¡çš„å­ç¨‹åºï¼Œå…è®¸æ‰§è¡Œè¢«æŒ‚èµ·ä¸è¢«æ¢å¤ã€‚ ä»çº¿ç¨‹è¯´èµ· æˆ‘ä»¬éƒ½çŸ¥é“çº¿ç¨‹æ˜¯æŠ¢å å¼çš„ï¼Œä½ å¯ä»¥ç»™çº¿ç¨‹è®¾ç½®ä¼˜å…ˆçº§ï¼Œä½†æ˜¯ CPU å®é™…æ‰§è¡Œçš„æ˜¯å“ªä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½æ§åˆ¶ï¼Œåªèƒ½é€šè¿‡é”çš„æ–¹å¼æ¥ä¿è¯ç¨‹åºçš„é€»è¾‘æ­£ç¡®ã€‚ åç¨‹æ˜¯åä½œå¼çš„ï¼Œæ˜¯ç¼–ç¨‹è¯­è¨€å±‚çº§çš„ï¼Œè€Œéç³»ç»Ÿå±‚çº§ã€‚å½“æˆ‘ä»¬åˆ‡æ¢åç¨‹æ—¶ï¼Œä¸æ¶‰åŠä»»ä½•ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤å¯ä»¥æŠŠåç¨‹çœ‹ä½œæ˜¯è½»é‡çš„çº¿ç¨‹ã€‚ Kotlin ä¸­çš„åç¨‹Kotlin è¯­è¨€ä»1.3å¼€å§‹æ”¯æŒåç¨‹ã€‚Kotlin ä¸­çš„åç¨‹åœ¨æ¦‚å¿µä¸Šä¸å…¶ä»–è¯­è¨€ç±»ä¼¼ï¼Œä½†å¹¶æ²¡æœ‰åƒå…¶ä»–è¯­è¨€æä¾› async ã€await å…³é”®å­—ï¼Œè€Œæ˜¯ä»¥æ‰©å±•åº“çš„å½¢å¼å­˜åœ¨ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯æŒ‚èµ·å‡½æ•°ï¼ˆå¯ä¸­æ–­å‡½æ•°ï¼‰ï¼Œå³å‡½æ•°å¯ä»¥åœ¨æŸä¸ªæ—¶å€™æš‚åœï¼Œå¹¶åœ¨æœªæ¥æŸä¸ªæ—¶å€™æ¢å¤ã€‚ æŒ‚èµ·å‡½æ•°ä»£ç ç¤ºä¾‹ï¼š æŒ‚èµ·å‡½æ•°ä½¿ç”¨ suspend å…³é”®å­—æ¥ä¿®é¥°ï¼Œç›¸æ¯”äºå¸¸è§„å‡½æ•°ï¼ŒæŒ‚èµ·å‡½æ•°å¤šäº†ä¸¤ä¸ªæ“ä½œï¼Œsuspend å’Œ resumeã€‚ suspendï¼šæŒ‚èµ·ï¼ˆæš‚åœï¼‰ï¼Œæš‚åœå½“å‰åç¨‹ï¼Œå¹¶ä¿å­˜æ‰€æœ‰çš„å±€éƒ¨å˜é‡ã€‚ resumeï¼šè®©æš‚åœçš„åç¨‹ä»æš‚åœå¤„ç»§ç»­æ‰§è¡Œã€‚ åç¨‹æä¾›äº†ä¸€ç§å…¨æ–°çš„å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„æ–¹å¼ã€‚ä½¿å¾—æˆ‘ä»¬å¯ä»¥åƒå†™åŒæ­¥ä»£ç é‚£æ ·å»å†™å¼‚æ­¥ä»£ç ï¼Œå‡å°‘äº†å›è°ƒåœ°ç‹±ï¼Œä»£ç çš„å¯è¯»æ€§ä¹Ÿå¾—åˆ°äº†å¢å¼ºã€‚åŒæ—¶åç¨‹è¿˜å†…ç½®äº†å–æ¶ˆæ“ä½œï¼Œè¿™å¯¹äº Android å¼€å‘è€…æ¥è¯´æ— ç–‘æ˜¯ä¸ªç¦éŸ³ã€‚ How do I use coroutines?Step 1ï¼šå¼•å…¥åç¨‹ä¾èµ–åº“1implementation &#39;org.jetbrains.kotlinx:kotlinx-coroutines-android:1.4.2&#39; Step2ï¼šå¯åŠ¨ä¸€ä¸ªåç¨‹12345678910println(&quot;Start&quot;)// Start a coroutineGlobalScope.launch &#123; delay(1000) println(&quot;Hello&quot;)&#125;Thread.sleep(2000) // wait for 2 secondsprintln(&quot;Stop&quot;) å¯ä¸­æ–­å‡½æ•°åªå…è®¸åœ¨åç¨‹æˆ–è€…å¦ä¸€ä¸ªå¯ä¸­æ–­å‡½æ•°ä¸­è°ƒç”¨ã€‚ Step3ï¼šä½¿ç”¨ async å¯åŠ¨åç¨‹12345val deferred = GlobalScope.async &#123; &quot;Hello&quot; &#125;val deferred2 = GlobalScope.async &#123; &quot;World&quot; &#125;runBlocking &#123; println(deferred.await() + deferred2.await())&#125; Step4ï¼šä½¿ç”¨ Dispather æ¥è¿›è¡Œçº¿ç¨‹è°ƒåº¦é¦–å…ˆæˆ‘ä»¬éœ€è¦æ¸…æ¥šä¸€ç‚¹ï¼šåç¨‹å¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œï¼Œsuspend å‡½æ•°å¹¶ä¸ä»£è¡¨åå°æ‰§è¡Œã€‚ é‚£ä¹ˆåç¨‹æ˜¯åœ¨å“ªä¸ªçº¿ç¨‹ä¸­è¿è¡Œå‘¢ï¼Ÿ 123GlobalScope.launch &#123; Log.d(TAG, &quot;thread = $&#123;Thread.currentThread().name&#125;&quot;)&#125; åç¨‹é€šè¿‡è°ƒåº¦å™¨ï¼ˆDispatherï¼‰æ¥å®ç°çº¿ç¨‹çš„è°ƒåº¦ï¼Œç›®å‰ Kotlin æä¾›äº†ä¸‹é¢ä¸‰ä¸ªè°ƒåº¦å™¨æ¥ç»™æˆ‘ä»¬ä½¿ç”¨ï¼š çº¿ç¨‹è°ƒåº¦ä»£ç ç¤ºä¾‹ï¼š å°æ€è€ƒï¼š printThreadName() å‡½æ•°è¿è¡Œåœ¨å“ªäº†çº¿ç¨‹å‘¢ï¼Œæ˜¯ IO çº¿ç¨‹è¿˜æ˜¯ Main çº¿ç¨‹ï¼Ÿ Step5ï¼šç†è§£å’Œä½¿ç”¨åç¨‹ä½œç”¨åŸŸä»ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åç¨‹çš„å¯åŠ¨éœ€è¦ä¸€ä¸ªä½œç”¨åŸŸï¼Œè¿™åœ¨ Android å¼€å‘ä¸­æ˜¯éå¸¸æœ‰ç”¨ä¸”å¿…è¦çš„ã€‚å½“ Activity æˆ–è€… Fragment é”€æ¯æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸è¯¥ Activity æˆ– Fragment ç»‘å®šçš„ä½œç”¨åŸŸæ¥å–æ¶ˆåç¨‹ï¼Œä»è€Œé¿å…äº§ç”Ÿå†…å­˜æ³„æ¼ã€‚ å¸¸ç”¨çš„ä½œç”¨åŸŸä¸€è§ˆè¡¨ï¼š Scope æè¿° ä½¿ç”¨åœºæ™¯ GlobalScope å…¨å±€ä½œç”¨åŸŸ åŸºæœ¬ä¸ä½¿ç”¨ï¼Œé™¤éåç¨‹æ˜¯å…¨å±€çš„ viewModelScope ä¸ viewModel ç»‘å®šçš„ä½œç”¨åŸŸ App å†…å¤§éƒ¨åˆ†åœºæ™¯ lifecycleScope ä¸ Lifecycle å¯¹è±¡ç»‘å®šçš„ä½œç”¨åŸŸï¼Œå¦‚ Activity æˆ– Fragment ä¸ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„ä¸€äº›åœºæ™¯ï¼Œä½¿ç”¨ Fragment æ—¶ï¼Œéœ€è¦åŒºåˆ† lifecycleScope å’Œ viewLifecycleOwner.lifecycleScope è‡ªå·±åˆ›å»ºä¸€ä¸ªæ–°çš„ scopeï¼š Step6ï¼šå–æ¶ˆåç¨‹å½“å¯åŠ¨å¤šä¸ªåç¨‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å–æ¶ˆå¯åŠ¨è¯¥åç¨‹çš„ä½œç”¨åŸŸæ¥å–æ¶ˆåç¨‹ï¼Œè€Œä¸éœ€è¦å•ç‹¬ç®¡ç†æ¯ä¸ªåç¨‹ã€‚ æœ‰çš„æ—¶å€™æˆ‘ä»¬å¹¶ä¸æƒ³å–æ¶ˆè¯¥ä½œç”¨åŸŸä¸‹çš„æ‰€æœ‰åç¨‹ï¼Œåªæƒ³å–æ¶ˆæŸä¸€ä¸ªï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿ åç¨‹æ„é€ å™¨ä¼šè¿”å›ä¸€ä¸ª**Job** å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥ Job æ¥ç®¡ç†åç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“ç„¶ä¹ŸåŒ…å«äº†å–æ¶ˆæ“ä½œã€‚é€šè¿‡ Job å–æ¶ˆçš„æ–¹å¼ä¸ä¼šå¯¹å…„å¼Ÿåç¨‹äº§ç”Ÿä»»ä½•å½±å“ã€‚ Step7ï¼šåç¨‹ä¸­çš„å¼‚å¸¸å¤„ç†Kotlin ä¸­çš„å¼‚å¸¸åœ¨å­¦ä¹ åç¨‹çš„å¼‚å¸¸å¤„ç†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ Kotlin ä¸­çš„å¼‚å¸¸ã€‚ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰ä½¿ç”¨ String.toInt() å‡½æ•°ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ‰©å±•å‡½æ•°çš„å®ç°ï¼š ç›´æ¥è°ƒç”¨äº† Java ä¸­çš„ parseInt æ–¹æ³•ï¼Œè¿™å°±å¾ˆæœ‰æ„æ€äº†ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ° parseInt æ–¹æ³•æ˜¯ä¼šæŠ›å‡ºå¼‚å¸¸çš„ï¼Œè¿™å¾ˆå®¹æ˜“ç†è§£ï¼Œä¸æ˜¯æ‰€æœ‰çš„ string å¯¹è±¡éƒ½æ˜¯æ•´å½¢çš„æ•°å­—ã€‚Java ä¸­é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚ ä½†æ˜¯åœ¨æˆ‘ä»¬åœ¨ Kotlin è°ƒç”¨ String.toInt æ—¶ï¼ŒIDE å¹¶æ²¡æœ‰æç¤ºæˆ‘ä»¬æ•è·å¼‚å¸¸ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼ŸåŸå› å¾ˆç®€å•ï¼ŒKotlin ä¸­æ²¡æœ‰å—æ£€æŸ¥çš„å¼‚å¸¸ï¼ˆChecked Exceptionsï¼‰ã€‚ç¢°åˆ°è¿™ç§æƒ…å†µï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æ•è·å¼‚å¸¸ï¼Œå¦åˆ™å°±ä¼š Crashã€‚è¿™å¯èƒ½ä¹Ÿæ˜¯å¤§éƒ¨åˆ†äººè¯Ÿç—… Kotlin çš„ä¸€ç‚¹ã€‚å…³äº Checked Exceptions çš„è®¾è®¡å¥½åä¸å¦ï¼Œè¿™é‡Œä¸åšè®¨è®ºï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ å¦‚æœåç¨‹å‘ç”Ÿäº†å¼‚å¸¸å½“ä¸€ä¸ªåç¨‹ç”±äºå¼‚å¸¸è¿è¡Œå¤±è´¥ï¼Œå®ƒä¼šä¼ æ’­è¯¥å¼‚å¸¸åˆ°å®ƒçš„çˆ¶çº§ï¼Œéšåå®ƒçš„çˆ¶çº§ä¼šå–æ¶ˆæ‰€æœ‰ç›¸å…³çš„å­åç¨‹ï¼Œå¹¶ç»§ç»­å‘ä¸Šä¼ é€’ã€‚ è¿™ä¸ªè¡Œä¸ºçœ‹ä¸Šå»æ˜¯æ¯”è¾ƒåˆç†çš„ï¼Œä½†æœ‰çš„æ—¶å€™æˆ‘ä»¬å¹¶ä¸å¸Œæœ›è¿™ä¹ˆåšã€‚å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå’Œ UI ç›¸å…³çš„ Scopeï¼Œè¿™ä¸ª scope çš„ä¸€ä¸ªå­åç¨‹æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¯¼è‡´æ•´ä¸ª scope è¢«å–æ¶ˆï¼Œç”±äºå–æ¶ˆåçš„ä½œç”¨åŸŸæ— æ³•å¯åŠ¨æ–°çš„åç¨‹ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸èƒ½è¢«æ¥å—çš„ã€‚ æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿåªéœ€è¦åœ¨åˆ›å»º scope æ—¶ï¼Œä½¿ç”¨ SupervisorJob è€Œä¸æ˜¯ Jobã€‚ å½“ä½¿ç”¨ SupervisorJob æ—¶ï¼Œä¸€ä¸ªå­åç¨‹æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¹¶ä¸ä¼šå–æ¶ˆå®ƒçš„çˆ¶çº§å’Œå…„å¼Ÿçº§ï¼Œä¹Ÿä¸ä¼šä¼ æ’­å¼‚å¸¸ï¼Œéœ€è¦å­åç¨‹è‡ªå·±å¤„ç†å¼‚å¸¸ï¼Œå¦‚æœå¼‚å¸¸æ²¡æœ‰å¤„ç†ï¼Œä¼šä¼ é€’åˆ° CoroutineContext ä¸­çš„ CoroutineExceptionHandler ä¸­ï¼Œå¦‚æœ CoroutineExceptionHandler ä¹Ÿæ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆä¼šç›´æ¥ Crashã€‚ æ€ä¹ˆå¤„ç†å¼‚å¸¸ä½¿ç”¨ try/cath å¤„ç† Why should I use coroutines? è½»é‡çº§ï¼šå¯ä»¥åŒæ—¶å¯åŠ¨æˆç™¾ä¸Šåƒä¸ªåç¨‹ï¼Œä½†å´ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ æ›´å°‘çš„å†…å­˜æ³„æ¼ï¼šä½¿ç”¨ç»“æ„åŒ–çš„å¹¶å‘åœ¨åŒä¸€ä½œç”¨åŸŸå†…æ‰§è¡Œå¤šä¸ªä»»åŠ¡ å†…ç½®å–æ¶ˆæ“ä½œï¼šæ–¹ä¾¿åœ¨é¡µé¢é”€æ¯æ—¶é‡Šæ”¾èµ„æºï¼Œå‡å°‘å†…å­˜æ³„æ¼ Jetpack æ”¯æŒï¼šRoomã€Paging ç­‰å®˜æ–¹æ”¯æŒåº“å…¨é¢æ”¯æŒåç¨‹ Coroutines â¤ï¸ï¸ Viewå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šä½¿ç”¨åç¨‹æ¥å¤„ç†å¤šçº¿ç¨‹é—®é¢˜ï¼Œæ¯”å¦‚ç½‘ç»œã€æ•°æ®åº“ç­‰ IO ä»»åŠ¡ã€‚å…¶å®åç¨‹ä¹Ÿå¯ä»¥å¤„ç†å•çº¿ç¨‹çš„å¼‚æ­¥ä»»åŠ¡ã€‚å•çº¿ç¨‹çš„å¼‚æ­¥ä»»åŠ¡å¬ä¸Šå»å¾ˆé™Œç”Ÿï¼Œä½†æ˜¯ä½ è‚¯å®šç”¨è¿‡å®ƒã€‚Android ä¸­æœ€å…¸å‹çš„å•çº¿ç¨‹ä»»åŠ¡å°±æ˜¯ä¸ View ç›¸å…³çš„ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚ View çš„ç»˜åˆ¶å’ŒåŠ¨ç”» ã€‚ Jetpack ä¸­æä¾›äº†å¾ˆå¤šæ‰©å±•å‡½æ•°æ¥å¸®æˆ‘ä»¬ç®€åŒ–ä»£ç ï¼Œå¦‚ View.doOnPreDraw()ï¼ŒAnimator.doOnEnd()è¿™äº›æ‰©å±•å‡½æ•°åªæ˜¯å¸®æˆ‘ä»¬å°†è€çš„å›è°ƒæ–¹å¼è½¬åŒ–æˆäº† Kotlin å‹å¥½çš„ lambda APIï¼Œè™½ç„¶çœ‹ä¸Šå»å¾ˆä¼˜é›…ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è§£å†³åµŒå¥—å›è°ƒçš„é—®é¢˜ã€‚ suspendCancellableCoroutinesuspendCancellableCoroutine å¯ä»¥ä»ä¸¤ä¸ªç»´åº¦æ¥æ‰§è¡Œåç¨‹çš„å–æ¶ˆæ“ä½œ åœ¨å¼‚æ­¥æ“ä½œå®Œæˆä¹‹å‰å–æ¶ˆåç¨‹ åœ¨åç¨‹è¢«æŒ‚èµ·çš„æ—¶å€™ï¼Œå¼‚æ­¥ UI æ“ä½œè¢«å–æ¶ˆæˆ–æŠ›å‡ºå¼‚å¸¸ ç­‰å¾… View å¸ƒå±€å®Œæˆ ç­‰å¾…åŠ¨ç”»æ‰§è¡Œå®Œæˆ å®æˆ˜æ¼”ç»ƒå¯èƒ½ä½ ä¼šè¯´è¿™æœ‰ä»€ä¹ˆç”¨ï¼Œä¸å°±æ˜¯æ¢äº†ä¸€ç§å†™æ³•å—ï¼Œä¸ç”¨åç¨‹ä¹Ÿå¯ä»¥å®ç°ã€‚æ˜¯çš„ï¼Œä½ ç¡®å®å¯ä»¥å®ç°ï¼Œä½†ç¢°åˆ°ä¸‹é¢è¿™ç§æƒ…å†µä½ å°±ä¼šè§‰å¾—æœ‰ç”¨äº†ã€‚ éœ€æ±‚ï¼šåŠ¨ç”»Aå’ŒåŠ¨ç”»BåŒæ—¶æ‰§è¡Œï¼Œç­‰ä¸¤ä¸ªåŠ¨ç”»éƒ½æ‰§è¡Œå®Œæˆåï¼Œå†æ‰§è¡ŒåŠ¨ç”»Cï¼ŒåŠ¨ç”»Cç»“æŸåå†é‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸ä½¿ç”¨åç¨‹è¯¥æ€ä¹ˆå®ç°ï¼š ä½¿ç”¨åç¨‹æ€ä¹ˆå®ç°ï¼š æ˜¯ä¸æ˜¯ä½¿ç”¨åç¨‹æ›´åŠ çš„ä¾¿æ·å’Œæ–¹ä¾¿å‘¢ï¼Ÿ QAï¼š æˆ‘èƒ½åœ¨ Java ä»£ç ä¸­ä½¿ç”¨åç¨‹å—ï¼Ÿ åç¨‹ç¨³å®šå—ï¼Œå¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å—ï¼Ÿ åç¨‹éš¾ä¸éš¾ï¼Œå­¦ä¹ æˆæœ¬æ˜¯ä¸æ˜¯å¾ˆå¤§ï¼Ÿ","tags":[]},{"title":"ä» LiveData åˆ°æµ","date":"2020-05-26T06:39:09.000Z","path":"2020/05/26/from-livedata-to-stream/","text":"ä»€ä¹ˆæ˜¯ LiveData? ä¸€ä¸ªå…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›çš„å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨ç±»ã€‚ ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ› å¯è§‚å¯Ÿ æ•°æ®å­˜å‚¨ Activity ç”Ÿå‘½å‘¨æœŸçš„çŠ¶æ€å’Œäº‹ä»¶ LiveData åªä¼šå°†æ›´æ–°é€šçŸ¥ç»™å¤„äºæ´»è·ƒçŠ¶æ€çš„è§‚å¯Ÿè€…ï¼Œæ´»è·ƒçŠ¶æ€æŒ‡è§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸåœ¨STARTEDæˆ–è€… RESUMEDã€‚å½“è§‚å¯Ÿè€…å¤„äº DESTROYEDæ—¶ä¼šè‡ªåŠ¨ç§»é™¤è¯¥è§‚å¯Ÿè€…ã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨ LiveDataï¼Ÿ æ— éœ€æ‰‹åŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸ ä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ å§‹ç»ˆä¿æŒé¡µé¢æ•°æ®ä¸ºæœ€æ–° é¡µé¢é—´å…±äº«æ•°æ® å®˜æ–¹å‡ºå“ï¼Œä¸ Room é…åˆé£Ÿç”¨æ›´ä½³ LiveData ä»€ä¹ˆæ—¶å€™ä¼šé€šçŸ¥æ›´æ–° æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ ç»„ä»¶ä»éæ´»è·ƒçŠ¶æ€æ›´æ”¹ä¸ºæ´»è·ƒçŠ¶æ€ ç¬¬äºŒæ¬¡ä»éæ´»è·ƒçŠ¶æ€æ›´æ”¹ä¸ºæ´»è·ƒçŠ¶æ€æ—¶ä¸ä¼šæ›´æ–° ä»æ›´æ–°çš„æ—¶æœºæ¥çœ‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶çš„ onCreate æ–¹æ³•ä¸­æ‰§è¡Œè§‚å¯Ÿæ–¹æ³•ï¼Œç¡®ä¿æ•°æ®å¯ä»¥é€šçŸ¥ã€‚æ¯”èµ·åœ¨ onResume æ–¹æ³•ä¸­æ‰‹åŠ¨æ›´æ–°æ•°æ®æ›´åŠ çš„é«˜æ•ˆã€‚ LiveData ä¸­çš„æ“ä½œç¬¦ map: ä¸ RxJava ä¸­çš„ map ç±»ä¼¼ switchMap: ä¸ RxJava ä¸­çš„ flatMap ç±»ä¼¼ distinctUntilChanged: ä¸ RxJava ä¸­çš„ distinctUntilChanged ç±»ä¼¼ï¼Œåªæœ‰å½“æ•°æ®æœ¬èº«å‘ç”Ÿæ”¹å˜æ—¶æ‰é€šçŸ¥ä¸‹æ¸¸ã€‚ MediatorLiveData: å½“ä¸Šè¿°æ“ä½œç¬¦æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå¯ä½¿ç”¨ MediatorLiveData æ¥è‡ªå®šä¹‰æ“ä½œç¬¦ã€‚ LiveData çš„é”™è¯¯ç”¨æ³• ä½¿ç”¨ Fragment ä½œä¸º LifecycleOwner ä¼ å…¥ observe æ–¹æ³• åœ¨ onCreate æ–¹æ³•ä¸­è·å–ç½‘ç»œæ•°æ®â é”™è¯¯çš„åšæ³•ï¼šå¦‚æœ Activity é‡å»ºï¼Œä¼šé‡æ–°å»è¯·æ±‚ä¸€æ¬¡æ•°æ®ï¼Œè¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚âœ… åªåœ¨éœ€è¦æ›´æ–°æ•°æ®æ—¶ï¼Œæ‰å»è¯·æ±‚ç½‘ç»œæ•°æ®ã€‚ æš´éœ²å¯å˜çš„ LiveData å¯¹è±¡ç»™å¤–éƒ¨ ä¸ºä»€ä¹ˆé¡¹ç›®ä¸­ä¼šæœ‰ Event å’Œ _EventObserver_ï¼Ÿ ä»å‰é¢ LiveData çš„æ›´æ–°æ—¶æœºæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œobserve æ–¹æ³•ä¼šå›è°ƒå¤šæ¬¡ã€‚ä½†æ˜¯å¯¹äº toastã€startActivityã€showDialog ç­‰äº‹ä»¶æˆ‘ä»¬åªä¼šæ¶ˆè´¹ä¸€æ¬¡ã€‚ Eventå’ŒEventObserverä¿è¯äº†äº‹ä»¶åªä¼šè¢«å¤„ç†ä¸€æ¬¡ã€‚ æ˜¯ä¸æ˜¯ä»»ä½•åœºæ™¯ä¸‹éƒ½å¯ä»¥ä½¿ç”¨ LiveData? å½“ç„¶ä¸æ˜¯ï¼Œåªè¦å½“æ•°æ®ä¸ UI æœ‰ç›¸å…³å…³ç³»æ—¶æ‰åº”è¯¥ä½¿ç”¨ LiveDataã€‚ è®¨è®ºï¼šå¯¹äºä¸€äº›å…¥å£æ˜¯å¦æ˜¾ç¤ºçš„æ§åˆ¶åº”è¯¥ä½¿ç”¨ LiveData å— LiveData ä¸ RxJavaè™½ç„¶ LiveData å’Œ RxJava éƒ½å±äºè§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°ï¼Œä½†æ˜¯ä»–ä»¬çš„æœ¬è´¨æ˜¯å®Œå…¨ä¸åŒçš„ã€‚ LiveData åªæ˜¯æ•°æ®çš„å‚¨å­˜ç±»ï¼Œæœ¬èº«ä¸æ”¯æŒå¤æ‚çš„çº¿ç¨‹æ“ä½œå’Œäº‹ä»¶åºåˆ—ï¼Œä¹Ÿæ²¡æœ‰å¼‚å¸¸å¤„ç†ã€‚ä¸ RxJava ç›¸æ¯”ï¼Œå…·æœ‰ä½“ç§¯å°ï¼Œå­¦ä¹ æˆæœ¬ä½ç­‰ä¼˜ç‚¹ã€‚ RxJava æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŸºäºäº‹ä»¶çš„è§‚å¯Ÿåºåˆ—ï¼Œç”¨æ¥å¤„ç†å¼‚æ­¥æ“ä½œçš„æ¡†æ¶ã€‚ä½¿ç”¨ RxJava å¯ä»¥æ–¹ä¾¿çš„åˆ‡æ¢çº¿ç¨‹ï¼ŒåŒæ—¶ RxJava æ‹¥æœ‰çš„ä¼—å¤šæ“ä½œç¬¦ä¹Ÿå¯ä»¥è®©é€»è¾‘å˜çš„æ¸…æ™°å¯å¾ªã€‚é…åˆ Retrofit å¤§å¤§åœ°ç®€åŒ–äº†ç½‘ç»œæ“ä½œã€‚ä½†æ˜¯å­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼Œå¤§éƒ¨åˆ†äººåªä¼šä¸€äº›ç®€å•çš„æ“ä½œã€‚ åœ¨ Android ä¸­å¯ä»¥ä½¿ç”¨ https://github.com/uber/AutoDispose æ¥é¿å… RxJava å­˜åœ¨çš„å†…å­˜æ³„æ¼ã€‚ LiveData ä¸ EventBusEventBus ä¹Ÿæ˜¯ä¸€ç§è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°ï¼Œä½†å¥¹æ›´å¤šçš„è¢«åº”ç”¨äºæ¨¡å—é—´çš„é€šä¿¡ï¼Œæ¯”å¦‚ä¸€äº›å…¨å±€æ€§çš„äº‹ä»¶é€šçŸ¥ï¼Œç±»ä¼¼ç™»å½•è¿™æ ·çš„ã€‚è€Œä¸æ˜¯åƒ LiveData ä¸€æ ·åªå…³å¿ƒå½“å‰é¡µé¢çš„æ•°æ®ã€‚ Cold or Hotcold observable åªæœ‰å½“äº‹ä»¶è¢«è®¢é˜…æ—¶æ‰ä¼šæ‰§è¡Œå‘å°„æ•°æ®çš„ä»£ç ã€‚å½“æœ‰å¤šä¸ªè®¢é˜…è€…æ—¶ï¼Œä»–ä»¬ä¹‹é—´çš„äº‹ä»¶æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ hot observable äº‹ä»¶çš„å‘ç”Ÿäºè®¢é˜…çš„æ—¶æœºæ— å…³ï¼Œå¤šä¸ªè®¢é˜…è€…å¯ä»¥è®¢é˜…åŒä¸€æ•°æ®æºã€‚ ä¸¾ä¸ªå½¢è±¡ä¸€äº›çš„ ğŸŒ°ï¼Œcold æ˜¯è€³æœºï¼Œhot æ˜¯éŸ³å“ LIveData æ˜¯ Hot observableï¼ŒRxJava å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯ Cold observableã€‚ å…³äº Cold å’Œ Hot çš„ç†è§£ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š https://medium.com/@benlesh/hot-vs-cold-observables-f8094ed53339 subscribe å’Œ observe","tags":[]},{"title":"Android é¡¹ç›®ç¼–è¯‘é€Ÿåº¦ä¼˜åŒ–","date":"2019-07-22T12:44:27.000Z","path":"2019/07/22/Android-build-speed-opt/","text":"Android ç¼–è¯‘è¿™ä»¶å°äº‹ä»€ä¹ˆæ˜¯ç¼–è¯‘ï¼Ÿæˆ‘ä»¬æ¯å¤©éƒ½è¦ç»å†æ•°åæ¬¡çš„ç¼–è¯‘ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ç¼–è¯‘å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠé«˜çº§è¯­è¨€è½¬åŒ–ä¸ºæœºå™¨æˆ–è™šæ‹Ÿæœºèƒ½è¯†åˆ«çš„ä½çº§è¯­è¨€çš„è¿‡ç¨‹ã€‚åœ¨ Android ä¸­ï¼Œå°±æ˜¯æŠŠæˆ‘ä»¬è®¤è¯†çš„ Java æˆ– Kotlin è¯­è¨€è½¬åŒ–ä¸º Android è™šæ‹Ÿæœºå¯ä»¥æ‰§è¡Œçš„ Dalvik å­—èŠ‚ç çš„è¿‡ç¨‹ã€‚ Android ä¸­çš„ç¼–è¯‘è¿‡ç¨‹ ç¼–è¯‘å™¨å°†æºä»£ç è½¬æ¢ä¸ºDexæ–‡ä»¶ï¼Œå…¶ä»–å†…å®¹è½¬åŒ–ä¸ºå·²ç¼–è¯‘èµ„æº æ‰“åŒ…å™¨æŠŠDexæ–‡ä»¶å’Œå·²ç¼–è¯‘èµ„æºåˆæˆ apkã€‚ æ‰“åŒ…å™¨ä½¿ç”¨ç­¾åç­¾ç½² apkã€‚ æ‰“åŒ…å™¨ä½¿ç”¨ zipalign å·¥å…·è¿›è¡Œä¼˜åŒ–ã€‚ç¼–è¯‘é€Ÿåº¦ å¤§è‡´äº†è§£äº†ç¼–è¯‘è¿‡ç¨‹ä¹‹åï¼Œæˆ‘ä»¬æœ€å…³å¿ƒçš„åº”è¯¥å°±æ˜¯ç¼–è¯‘é€Ÿåº¦äº†ã€‚ç¼–è¯‘é€Ÿåº¦çš„å¿«æ…¢ç›´æ¥å†³å®šäº†ç ”å‘æ•ˆç‡çš„é«˜ä½ï¼Œå°¤å…¶æ˜¯å¤šäººåä½œçš„é¡¹ç›®ã€‚æ¯ä¸ªäººèŠ‚çœ1åˆ†é’Ÿï¼Œ5ä¸ªäººå°±æ˜¯5åˆ†é’Ÿï¼Œæ¯å¤©å¹³å‡ç¼–è¯‘20æ¬¡ï¼Œé‚£å°±æ˜¯100åˆ†é’Ÿï¼Œ1å°æ—¶40åˆ†é’Ÿã€‚è¿™ä¹ˆçœ‹æ¥ï¼ŒæŒ‰æ—¶ä¸‹ç­ä¹Ÿæœ‰äº†å¸Œæœ›ã€‚ å…³äºç¼–è¯‘é€Ÿåº¦ï¼Œæˆ‘ä»¬æœ€å…³å¿ƒçš„åº”è¯¥æ˜¯ç¼–è¯‘ debug åŒ…çš„é€Ÿåº¦ï¼Œè¿™ç›´æ¥å½±å“æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚ä»æˆ‘ä»¬å†™å®Œä»£ç åˆ°å®‰è£…åˆ°æ‰‹æœºä¸Šç”Ÿæ•ˆï¼Œå…¶ä¸­åŒ…å«äº†ä¸¤ä¸ªæ—¶é—´ï¼Œä¸€ä¸ªæ˜¯ç¼–è¯‘æ—¶é—´ï¼Œä¸€ä¸ªæ˜¯å®‰è£…æ—¶é—´ã€‚ç¼–è¯‘æ—¶é—´ä¸­ï¼Œæˆ‘ä»¬æœ€å…³å¿ƒçš„åº”è¯¥æ˜¯å¢é‡ç¼–è¯‘ï¼ˆincremental buildï¼‰çš„æ—¶é—´ï¼Œå¼€å‘é˜¶æ®µå¤§éƒ¨åˆ†çš„ç¼–è¯‘å‡å±äºæ­¤ç±»ã€‚é‚£ä¹ˆå¦‚ä½•æé«˜å¢é‡ç¼–è¯‘çš„é€Ÿåº¦æ‰æ˜¯æ ¸å¿ƒã€‚è‡³äºå®‰è£…æ—¶é—´ï¼Œå¯ä»¥ä½¿ç”¨å¥½ä¸€ç‚¹çš„æµ‹è¯•æœºå’Œå‡çº§æ–°çš„å·¥å…·é“¾è§£å†³ã€‚ ç¼–è¯‘é€Ÿåº¦çš„ä¼˜åŒ– ç¡¬ä»¶åŠ é€Ÿï¼Œä½¿ç”¨é…ç½®é«˜çš„ç”µè„‘è¿›è¡Œå¼€å‘å·¥ä½œã€‚ ä¿æŒ Android SDK Toolsã€Android Gradle Plugin æ’ä»¶ ä¸ºæœ€æ–°ç‰ˆæœ¬ï¼Œäº«å— Google çš„æœ€æ–°ä¼˜åŒ–æˆæœã€‚ é¡¹ç›®æ¨¡å—åŒ–ã€‚æ¨¡å—åŒ–çš„é¡¹ç›®å¯ä»¥äº«å—åˆ° Gradle å¹¶è¡Œç¼–è¯‘çš„å¥½å¤„ã€‚ å¯ç”¨ Instant Runã€‚ä½œä¸º Google å®˜æ–¹çš„åŠ é€Ÿå¢é‡ç¼–è¯‘çš„æ–¹æ¡ˆï¼Œè™½ç„¶ä¸€ç›´è¢«äººè¯Ÿç—…ï¼Œä½†ä¸€äº›æƒ…å†µä¸‹è¿˜æ˜¯å¯ä»¥æå‡ç¼–è¯‘é€Ÿåº¦çš„ã€‚ åœ¨å¼€å‘é˜¶æ®µç¦ç”¨æŸäº› SDKï¼Œæ¯”å¦‚ Crashlyticsã€‚ åœ¨å¼€å‘é˜¶æ®µä½¿ç”¨é™æ€çš„ç¼–è¯‘é…ç½®å‚æ•°ã€‚ä¾‹å¦‚æˆ‘ä»¬é¡¹ç›®ä¸­åŸºæœ¬éƒ½å­˜åœ¨ BuildConfig BUILD_TIME å‚æ•°ï¼Œåœ¨ debug ç¯å¢ƒä¸‹å¯ç›´æ¥å†™æˆ0ã€‚ è®¾ç½® minSdkVersion ä¸º 21ã€‚æ ¹æ®å„äº§å“éœ€æ±‚è€Œå®šï¼ŒminSdkVersion ä¸º16çš„å¯ä»¥åœ¨å¼€å‘é˜¶æ®µåšæ­¤è®¾ç½®ã€‚ å°†é¡¹ç›®ä¸­çš„å›¾ç‰‡è½¬æ¢ä¸ºwebpã€‚ç¼–è¯‘é˜¶æ®µæ— éœ€è¿›è¡Œå‹ç¼©ï¼Œä»è€ŒåŠ å¿«ç¼–è¯‘é€Ÿåº¦ã€‚ åœ¨å¼€å‘é˜¶æ®µç¦æ­¢è‡ªåŠ¨å‹ç¼©å›¾ç‰‡ã€‚å‘å¸ƒç‰ˆæœ¬å‰éœ€æ‰‹åŠ¨è®¾ç½®ä¸º trueï¼Œæ— æ³•ä½¿ç”¨æ„å»ºç±»å‹å’Œäº§å“é£å‘³ä¿®æ”¹æ­¤å±æ€§ã€‚123aaptOptions &#123; cruncherEnabled false &#125; åŠ é€Ÿ gradle çš„ä¸€äº›è®¾ç½®12345678910// å¼€å¯å¹¶è¡Œç¼–è¯‘ï¼Œåœ¨å¤š module é¡¹ç›®ä¸­å¾ˆå®ç”¨org.gradle.parallel=true// å¼€å¯ gradle è¿›ç¨‹å®ˆæŠ¤ï¼Œæ— éœ€æ¯æ¬¡ç¼–è¯‘éƒ½å¯åŠ¨ gradle è¿›ç¨‹org.gradle.daemon=true// å¼€å¯æŒ‰éœ€é…ç½®org.gradle.configureondemand=true// è®¾ç½® gradle æœ€å¤§å†…å­˜ï¼Œå¹¶éè¶Šå¤§è¶Šå¥½ï¼Œæ ¹æ®å®˜æ–¹æ•°æ® 1g æˆ– 2g æœ€ä½³org.gradle.jvmargs=-Xmx2g// å¼€å¯ gradle æ„å»ºç¼“å­˜org.gradle.caching=true å¦‚æœé¡¹ç›®ä¸­æœ‰ä½¿ç”¨ Kotlin è¯­è¨€ï¼Œå°½é‡ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Kotlinã€‚åœ¨ Kotlin 1.1.1 ç‰ˆæœ¬é»˜è®¤æ”¯æŒ JVM çš„å¢é‡ç¼–è¯‘ï¼Œ1.2.20 é»˜è®¤æ”¯æŒ Gradle Build Cacheã€‚ å¼€å¯ kapt çš„ å„ç§åŠ é€Ÿè®¾ç½® ç¼–è¯‘ç¼“å­˜ï¼ˆ1.2.20ï¼‰åœ¨build.gradleæ–‡ä»¶ä¸­æ·»åŠ ï¼š123kapt &#123; useBuildCache = true&#125; å¹¶è¡Œä»»åŠ¡ï¼ˆ1.2.60ï¼‰åœ¨ gradle.propertiesæ–‡ä»¶ä¸­æ·»åŠ ï¼š1kapt.use.worker.api=true ç¼–è¯‘å›é¿ï¼ˆ1.3.20ï¼‰åœ¨ gradle.propertiesæ–‡ä»¶ä¸­æ·»åŠ ï¼š1kapt.include.compile.classpath=false å¢é‡ç¼–è¯‘ï¼ˆ1.3.30ï¼‰åœ¨ gradle.propertiesæ–‡ä»¶ä¸­æ·»åŠ ï¼š1kapt.incremental.apt=true ä½¿ç”¨ â€“profile å‘½ä»¤åˆ†æç¼–è¯‘è¿‡ç¨‹ï¼Œæ‰¾åˆ°è€—æ—¶çš„ Taskï¼Œé€ä¸ªè¿›è¡Œä¼˜åŒ–ã€‚ é’ˆå¯¹æ¨¡å—åŒ–é¡¹ç›®çš„ç¼–è¯‘ä¼˜åŒ–å»ºè®® åˆ›å»ºçº¯ç²¹çš„ Java/Kotlin åº“ï¼Œå› ä¸ºçº¯ç²¹çš„ Java/Kotlin åº“çš„ Gradle Task ä¾èµ–æ ‘éå¸¸ç®€å•ã€‚ åªåº”ç”¨éœ€è¦çš„ Gradle æ’ä»¶ã€‚ åˆ†ç¦»AP(Annotation Processors)åˆ°å•ç‹¬çš„ Moduleã€‚ä» Gradle 4.7 ç‰ˆæœ¬ï¼Œæ”¯æŒ AP çš„å¢é‡ç¼–è¯‘ï¼›ä» Kotlin 1.3.30 ç‰ˆæœ¬ï¼Œkapt ä¹Ÿæ”¯æŒå¢é‡ç¼–è¯‘ã€‚åœ¨ gradle.properties ä¸­æ·»åŠ 1kapt.incremental.apt=true åªåœ¨ app module ä¸­ä½¿ç”¨ lintã€‚123lintOptions &#123; tasks.lint.enabled = false &#125; ä½¿ç”¨ api æˆ– implementation è€Œä¸æ˜¯ compileã€‚ ä½¿ç”¨ ext æˆ– buildSrc æ¥ç®¡ç†ç‰ˆæœ¬ä¾èµ–ã€‚","tags":[]},{"title":"31DaysOfKotlin","date":"2019-06-23T09:40:39.000Z","path":"2019/06/23/31DaysOfKotlin/","text":"#31 å¤©å­¦ä¹  Kotlin â€” ç¬¬ä¸€å‘¨å›é¡¾æˆ‘ä»¬å†™çš„ Kotlin ä»£ç è¶Šå¤šï¼Œæˆ‘ä»¬è¶Šå–œæ¬¢å¥¹ï¼Kotlin çš„ç°ä»£è¯­è¨€ç‰¹æ€§å’Œ Android KTX ä½¿æˆ‘ä»¬çš„ Android ä»£ç æ›´åŠ çš„ç®€æ´ï¼Œæ¸…æ™°å’Œä¼˜é›…ã€‚æˆ‘ä»¬ ï¼ˆ@FMuntenescu å’Œ @objcodeï¼‰å¯åŠ¨äº† #31DaysOfKotlin ç³»åˆ—ä½œä¸ºåˆ†äº«æˆ‘ä»¬æœ€å–œçˆ±çš„ Kotlin å’Œ Android KTX ç‰¹æ€§çš„ä¸€ç§æ–¹å¼ï¼Œå¸Œæœ›ä½ å’Œæˆ‘ä»¬ä¸€æ ·ï¼Œè¶Šæ¥è¶Šå–œæ¬¢å¥¹ã€‚ åœ¨å‰ 7 å¤©çš„æ—¶é—´é‡Œï¼Œæˆ‘ä»¬ä¸“æ³¨äºåŸºç¡€çŸ¥è¯†ã€‚ Day 1: Elvis æ“ä½œç¬¦éœ€è¦å¤„ç†ä»£ç ä¸­çš„ç©ºå€¼ï¼Ÿå¯ä»¥ä½¿ç”¨ elvis æ“ä½œç¬¦ï¼Œé¿å…æ‚¨çš„ â€œç©ºæƒ…å†µâ€ (null-erplate)ã€‚è¿™åªæ˜¯æ›¿æ¢ç©ºä½œä¸ºå€¼æˆ–è€…è¿”å›äº‹ä»¶æƒ…å†µçš„ä¸€ä¸ªå°è¯­æ³•ã€‚æ–‡æ¡£ï¼š Elvis operator. 12val name: String = person.name ?: â€œunknownâ€val age = person.age ?: return Day 2: å­—ç¬¦ä¸²æ¨¡æ¿æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Ÿå°† $ ç¬¦æ”¾åœ¨å˜é‡åçš„å‰é¢è¡¨è¾¾å­—ç¬¦ä¸²ä¸­çš„å˜é‡å’Œè¡¨è¾¾å¼ã€‚ä½¿ç”¨ ${expression} æ±‚è¡¨è¾¾å¼çš„å€¼ã€‚æ–‡æ¡£ï¼š string templates. 1234val language = â€œKotlinâ€// â€œKotlin has 6 charactersâ€val text = â€œ$language has $&#123;language.length&#125; charactersâ€ Day 3: è§£æ„å£°æ˜Android KTX ä½¿ç”¨è§£æ„æ¥æŒ‡å®šé¢œè‰²çš„ç»„ä»¶å€¼ã€‚ ä½ å¯ä»¥åœ¨ç±»ä¸­ä½¿ç”¨è§£æ„ï¼Œæˆ–è€…æ‰©å±•ç°æœ‰çš„ç±»æ¥æ·»åŠ è§£æ„ã€‚æ–‡æ¡£: destructuring declarations. 12345678// now with prismsval (red, green, blue) = color// destructuring for squaresval (left, top, right, bottom) = rect// or more pointedlyval (x, y) = point Day 4: When è¡¨è¾¾å¼å¼ºå¤§çš„ switchï¼Kotlin çš„ When è¡¨è¾¾å¼å‡ ä¹å¯ä»¥åŒ¹é…ä»»ä½•ä¸œè¥¿ã€‚å­—é¢å€¼ï¼Œæšä¸¾ï¼Œæ•°å­—èŒƒå›´ã€‚æ‚¨ç”šè‡³å¯ä»¥è°ƒç”¨ä»»æ„çš„å‡½æ•°ï¼æ–‡æ¡£: when 1234567891011class Train(val cargo: Number?) &#123; override fun toString(): String &#123; return when (cargo) &#123; null, 0 -&gt; &quot;empty&quot; 1 -&gt; &quot;tiny&quot; in 2..10 -&gt; &quot;small&quot; is Int -&gt; &quot;big inty&quot; else -&gt; &quot;$cargo&quot; &#125; &#125;&#125; Day 5: å¾ªç¯ï¼ŒèŒƒå›´è¡¨è¾¾å¼ä¸è§£æ„for å¾ªç¯åœ¨ä¸å…¶ä»–ä¸¤ç§ Kotlin ç‰¹æ€§ä¸€èµ·ä½¿ç”¨æ—¶å¯ä»¥è·å¾—è¶…çº§èƒ½åŠ›ï¼šèŒƒå›´è¡¨è¾¾å¼å’Œè§£æ„ã€‚ æ–‡æ¡£: ranges, destructuring. 12345678910111213141516// iterating in the range 1 to 100for(i in 1..100) &#123;&#125;// iterating backwards, in the range 100 to 1for(i in 100 downTo 1)&#123;&#125;// iterating over an array, getting every other elementval array = arrayOf(â€œaâ€, â€œbâ€, â€œxâ€)for(i in 1 until array.size step 2 )&#123;&#125;// iterating over an array with the item index and destructuringfor((index, element) in array.withIndex()) &#123;&#125;// iterating over a mapval map = mapOf(1 to â€œoneâ€, 2 to â€œtwoâ€)for( (key, value) in map)&#123;&#125; Day 6: å±æ€§åœ¨ Kotlin ä¸­ï¼Œç±»å¯ä»¥å…·æœ‰å¯å˜å’Œåªè¯»å±æ€§ï¼Œé»˜è®¤æƒ…å†µä¸‹ç”Ÿæˆ getter å’Œ setterã€‚å¦‚æœéœ€è¦ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚æ–‡æ¡£: properties. 12345678910111213141516class User &#123; // properties val id: String = â€œâ€ // immutable. just getter var name: String = â€œâ€ // default getter and setter var surname: String = â€œâ€ // custom getter, default setter get() = surname.toUpperCase() // custom getter declaration var email: String = â€œâ€ // default getter, custom setter set(value) &#123; // custom setter declaration // â€œvalueâ€ = name of the setter parameter // â€œfieldâ€ = propertyâ€™s backing field; generated if(isEmailValid(value)) field = value &#125;&#125; Day 7: Data ç±» and equalityåˆ›å»ºä¸€ä¸ªå¤„ç†æ•°æ®çš„ç±»ï¼Ÿå°†å®ƒä»¬æ ‡è®°ä¸º â€œDataâ€ ç±»ã€‚å¹¶é»˜è®¤å®ç°ç”Ÿæˆ equals() æ–¹æ³• - ç›¸å½“äº hashCode()ï¼ŒtoString() å’Œ copy()ï¼Œå¹¶æ£€æŸ¥ç»“æ„æ˜¯å¦ç›¸ç­‰ã€‚æ–‡æ¡£: data classes, equality 12345678910111213141516data class User( val name: String, val email: String, val address: Address)public class UserListDiffCallback: DiffUtil.Callback() &#123; override fun areContentsTheSame( oldItemPosition: Int, newItemPosition: Int ): Boolean &#123; // use the generated equals method return newUserList[newItemPosition] == oldUserList[oldItemPosition])&#125; æœ¬å‘¨é‡ç‚¹ä»‹ç»äº† Kotlin çš„åŸºç¡€ï¼šå¤„ç†ç©ºé”™è¯¯ï¼Œç®€åŒ–å¾ªç¯å’Œæ¡ä»¶ï¼Œæ”¹è¿› getter å’Œ setterï¼Œä»¥åŠåˆ é™¤æ ·æ¿ã€‚ ä¸‹å‘¨æˆ‘ä»¬å°†æ·±å…¥äº†è§£æ›´å¤š Kotlin åŠŸèƒ½ï¼ #31 å¤©å­¦ä¹  Kotlin â€” ç¬¬äºŒå‘¨å›é¡¾åœ¨ç¬¬äºŒéƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ¢ç´¢ Kotlin - æ·±å…¥ç ”ç©¶å¯†å°ç±»å’Œå†…è”ç­‰ã€‚ Day 8: å¯è§æ€§åœ¨ Kotlin ä¸­ä¸€åˆ‡éƒ½æ˜¯é»˜è®¤ public çš„ã€‚å¹¶ä¸” Kotlin è¿˜æœ‰ä¸€å¥—ä¸°å¯Œçš„å¯è§æ€§ä¿®é¥°ç¬¦ï¼Œä¾‹å¦‚ï¼šprivate, protected, internalã€‚å®ƒä»¬æ¯ä¸ªéƒ½ä»¥ä¸åŒçš„æ–¹å¼é™ä½äº†å¯è§æ€§ã€‚ æ–‡æ¡£: visibility modifiers 12345678910111213141516171819// public by defaultval isVisible = true// only in the same fileprivate val isHidden = true// internal to compilation â€˜moduleâ€™internal val almostVisible = trueclass Foo &#123; // public by default val isVisible = true // visible to my subclasses protected val isInheritable = true // only in the same class private val isHidden = true&#125; Day 9: é»˜è®¤å‚æ•°æ–¹æ³•å‚æ•°çš„æ•°é‡æ˜¯å¦å¤ªå¤šï¼Ÿåœ¨å‡½æ•°ä¸­æŒ‡å®šé»˜è®¤å‚æ•°å€¼ã€‚ä½¿ç”¨å‘½åå‚æ•°ä½¿ä»£ç æ›´å…·å¯è¯»æ€§ã€‚ æ–‡æ¡£: default arguments 12345678910111213141516// parameters with default valuesclass BulletPointSpan( private val bulletRadius: Float = DEFAULT_BULLET_RADIUS, private val gapWidth: Int = DEFAULT_GAP_WIDTH, private val color: Int = Color.BLACK)// using only default valuesval bulletPointSpan = BulletPointSpan()// passing a value for the first argument, others defaultval bulletPointSpan2 = BulletPointSpan( resources.getDimension(R.dimen.radius))// using a named parameter for the last argument, others defaultval bulletPointSpan3 = BulletPointSpan(color = Color.RED) Day 10: Sealed ç±»Kotlin çš„ sealed ç±»å¯ä»¥è®©ä½ è½»æ¾åœ°å¤„ç†é”™è¯¯æ•°æ®ï¼Œå½“ç»“åˆ LiveData æ—¶ï¼Œ ä½ å¯ä»¥ç”¨ä¸€ä¸ª LiveData åŒæ—¶ä»£è¡¨æˆåŠŸå’Œå¤±è´¥çš„æƒ…å†µï¼Œè¿™æ¯”ç”¨ä¸¤ä¸ªå˜é‡è¦å¥½ã€‚æ–‡æ¡£: sealed classes 123456789101112sealed class NetworkResultdata class Success(val result: String): NetworkResult()data class Failure(val error: Error): NetworkResult()// one observer for success and failureviewModel.data.observe(this, Observer &#123; data -&gt; data ?: return@Observer // skip nulls when(data) &#123; is Success -&gt; showResult(data.result) // smart cast to Success is Failure -&gt; showError(data.error) // smart cast to Failure &#125;&#125;) ä½ ä¹Ÿå¯ä»¥å°† sealed ç±»ç”¨åœ¨ RecyclerView çš„ adapter ä¸­ã€‚å®ƒä»¬éå¸¸é€‚åˆ ViewHolders â€”â€” ç”¨ä¸€ç»„æ¸…æ™°çš„ç±»å‹æ˜ç¡®åœ°åˆ†æ´¾ç»™æ¯ä¸ª holderã€‚ç”¨ä½œè¡¨è¾¾å¼æ—¶ï¼Œå¦‚æœæœ‰ç±»å‹ä¸åŒ¹é…ï¼Œç¼–è¯‘å™¨å°†ä¼šæŠ¥é”™ã€‚ 123456789101112// use Sealed classes as ViewHolders in a RecyclerViewAdapteroverride fun onBindViewHolder( holder: SealedAdapterViewHolder?, position: Int) &#123; when (holder) &#123; // compiler enforces handling all types is HeaderHolder -&gt; &#123; holder.displayHeader(items[position]) // smart cast here &#125; is DetailsHolder -&gt; &#123; holder.displayDetails(items[position]) // smart cast here &#125; &#125;&#125; ä½¿ç”¨ RecyclerViews æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šæ¥è‡ª RecyclerView ä¸­ item çš„å›è°ƒï¼Œæ¯”å¦‚ä¸€ä¸ªç‚¹å‡»ï¼Œåˆ†äº«å’Œåˆ é™¤ item çš„é¡¹ç›®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ sealed ç±»ã€‚ä¸€ä¸ªå›è°ƒå°±å¯ä»¥å¤„ç†æ‰€æœ‰çš„äº‹æƒ…ï¼ 1234567891011121314151617sealed class DetailItemClickEventdata class DetailBodyClick(val section: Int): DetailItemClickEvent()data class ShareClick(val platform: String): DetailItemClickEvent()data class DeleteClick(val confirmed: Boolean): DetailItemClickEvent()class MyHandler : DetailItemClickInterface &#123; override fun onDetailClicked(item: DetailItemClickEvent) &#123; when (item) &#123; // compiler enforces handling all types is DetailBodyClick -&gt; expandBody(item.section) is ShareClick -&gt; shareOn(item.platform) is DeleteClick -&gt; &#123; if (item.confirmed) doDelete() else confirmDetele() &#125; &#125; &#125;&#125; Day 11: æ‡’åŠ è½½æ‡’åŠ è½½æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼é€šè¿‡ä½¿ç”¨æ‡’åŠ è½½ï¼Œå¯ä»¥çœå»æ˜‚è´µçš„å±æ€§åˆå§‹åŒ–æˆæœ¬ï¼Œç›´åˆ°å®ƒä»¬çœŸæ­£éœ€è¦ã€‚è®¡ç®—å€¼ç„¶åä¿å­˜å¹¶ä¸ºäº†æœªæ¥ä»»ä½•æ—¶å€™çš„è°ƒç”¨ã€‚æ–‡æ¡£: lazy 123val preference: String by lazy &#123; sharedPreferences.getString(PREFERENCE_KEY)&#125; Day 12: LateinitAndroid ä¸­ï¼Œåœ¨ onCreate æˆ–è€…å…¶å®ƒçš„å›è°ƒåˆå§‹åŒ–å¯¹è±¡ï¼Œä½†åœ¨ Kotlin ä¸­ä¸ä¸ºç©ºçš„å¯¹è±¡å¿…é¡»åˆå§‹åŒ–ã€‚é‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿå¯ä»¥è¾“å…¥ lateinitã€‚æ¥æ‰¿è¯ºæœ€ç»ˆå°†ä¼šåˆå§‹åŒ–ã€‚æ‹‰é’©ä¿è¯å®ƒæ˜¯ç©ºå®‰å…¨çš„ã€‚ æ–‡æ¡£: lateinit 1234567891011class MyActivity : AppCompatActivity() &#123; // non-null, but not initalized lateinit var recyclerView: RecyclerView override fun onCreate(savedInstanceState: Bundle?) &#123; // â€¦ // initialized here recyclerView = findViewById(R.id.recycler_view) &#125;&#125; Day 13: Require å’Œ checkä½ æ–¹æ³•çš„å‚æ•°æ˜¯æœ‰æ•ˆçš„å—ï¼Ÿç”¨ require åœ¨ä½¿ç”¨å‰å¯ä»¥æ£€æŸ¥å®ƒä»¬ï¼Œå¦‚æœå®ƒä»¬æ˜¯æ— æ•ˆçš„å°†ä¼šæŠ›å‡º IllegalArgumentExceptionã€‚æ–‡æ¡£: require 123456fun setName(name: String) &#123; // calling setName(â€œâ€) throws IllegalArgumentException require(name.isNotEmpty()) &#123; â€œInvalid nameâ€ &#125; // â€¦&#125; æ‚¨çš„å°é—­ç±»çš„çŠ¶æ€æ˜¯å¦æ­£ç¡®ï¼Ÿå¯ä»¥ä½¿ç”¨ check æ¥éªŒè¯ã€‚å¦‚æœæ£€æŸ¥çš„å€¼ä¸º falseï¼Œå®ƒå°†æŠ›å‡º IllegalStateExceptionã€‚æ–‡æ¡£: check 12345fun User.logOut()&#123; // When not authenticated, throws IllegalStateException check(isAuthenticated()) &#123; â€œUser $email is not authenticatedâ€ &#125; isAuthenticated = false&#125; Day 14: å†…è”ç­‰ä¸åŠè¦ä½¿ç”¨ lambdas æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„æ¥å£ï¼Ÿkotlin å¯ä»¥è®©ä½ å®šä¹‰ä¸€ä¸ª inline çš„æ–¹æ³• â€“ è¿™æ„å‘³ç€è°ƒç”¨å°†æ›¿æ¢æ–¹æ³•ä½“ï¼Œç”¨å¾ˆéå¸¸ç®€å•çš„æ–¹æ³•æ¥ç”Ÿæˆ lambda çš„æ¥å£ã€‚æ–‡æ¡£: inline functions 1234567891011121314151617// define an inline function that takes a function argumentinline fun onlyIf(check: Boolean, operation: () -&gt; Unit) &#123; if (check) &#123; operation() &#125;&#125;// call it like thisonlyIf(shouldPrint) &#123; // call: pass operation as a lambda println(â€œHello, Kotlinâ€)&#125;// which will be inlined to thisif (shouldPrint) &#123; // execution: no need to create lambda println(â€œHello, Kotlinâ€)&#125; æœ¬å‘¨æ·±å…¥ç ”ç©¶äº† Kotlin çš„ç‰¹æ€§ï¼šå¯è§æ€§ï¼Œé»˜è®¤å‚æ•°ï¼Œå¯†å°ç±»ï¼Œæ‡’åŠ è½½ï¼Œå»¶è¿Ÿåˆå§‹åŒ–ï¼Œrequire å’Œ checkï¼Œä»¥åŠå¼ºå¤§çš„å†…è”ã€‚ ä¸‹å‘¨æˆ‘ä»¬å°†æ·±å…¥äº†è§£æ›´å¤šçš„ Kotlin ç‰¹æ€§å¹¶å¼€å§‹æ¢ç´¢ Android KTXã€‚ #31 å¤©å­¦ä¹  Kotlin â€” ç¬¬ä¸‰å‘¨å›é¡¾ç¬¬ 3 å‘¨åˆ†ä¸º Kotlin ç‰¹æ€§å’Œä½¿ç”¨ Android KTX ä½¿ Android ä»£ç æ›´ä¼˜é›…çš„å‡ ç§æ–¹å¼ã€‚ Day 15: æ“ä½œç¬¦é‡è½½ç”¨æ“ä½œç¬¦é‡è½½å¯ä»¥æ›´å¿«é€Ÿå†™ Kotlinã€‚åƒ Pathï¼ŒRange æˆ– SpannableStrings è¿™æ ·çš„å¯¹è±¡å…è®¸åƒåŠ æˆ–å‡è¿™æ ·çš„æ“ä½œã€‚é€šè¿‡ Kotlinï¼Œä½ å¯ä»¥å®ç°è‡ªå·±çš„æ“ä½œç¬¦ã€‚ æ–‡æ¡£: operator overloading, Android KTX usage example. 1234567891011// Definition/** Adds a span to the entire text. */inline operator fun Spannable.plusAssign(span: Any) =setSpan(span, 0, length, SPAN_INCLUSIVE_EXCLUSIVE)// Use it like thisval spannable = â€œEureka!!!!â€.toSpannable()spannable += StyleSpan(BOLD) // Make the text bold with +=spannable += UnderlineSpan() // Make the text underline with += Day 16: é¡¶å±‚æ–¹æ³•å’Œå‚æ•°ç±»çš„å·¥å…·æ–¹æ³•ï¼Ÿå°†å®ƒä»¬æ·»åŠ åˆ°æºæ–‡ä»¶çš„é¡¶å±‚ã€‚åœ¨ Java ä¸­ï¼Œå®ƒä»¬è¢«ç¼–è¯‘ä¸ºè¯¥ç±»çš„é™æ€æ–¹æ³•ã€‚æ–‡æ¡£: basic syntax. 123456789// Define a top-level function that creates a DataBinding Adapter for a RecyclerView@BindingAdapter(â€œuserItemsâ€)fun userItems(recyclerView: RecyclerView, list: List?)&#123; //update the RecyclerView with the new list â€¦&#125;class UsersFragment: Fragment&#123;...&#125; ä½ æ˜¯å¦ä¸ºä½ çš„ç±»å®šä¹‰äº†é™æ€å¸¸é‡ï¼Ÿä½¿å®ƒä»¬æˆä¸ºé¡¶å±‚å±æ€§ã€‚å®ƒä»¬å°†è¢«ç¼–è¯‘ä¸ºå­—æ®µå’Œé™æ€è®¿é—®å™¨ã€‚ 12345678910// Define a top-level property for Room databaseprivate const val DATABASE_NAME = â€œMyDatabase.dbâ€private fun makeDatabase(context: Context): MyDatabase &#123; return Room.databaseBuilder( context, MyDatabase::class.java, DATABASE_NAME ).build()&#125; Day 17: åœ¨æ²¡æœ‰è¿­ä»£å™¨çš„æƒ…å†µä¸‹è¿­ä»£ç±»å‹è¿­ä»£å™¨ç”¨åœ¨äº†æœ‰è¶£çš„åœ°æ–¹ï¼Android KTX å°†è¿­ä»£å™¨æ·»åŠ åˆ° ViewGroup å’Œ SparseArrayã€‚è¦å®šä¹‰è¿­ä»£å™¨æ‰©å±•è¯·ä½¿ç”¨ operator å…³é”®å­—ã€‚ Foreach å¾ªç¯å°†ä½¿ç”¨æ‰©å±•åï¼æ–‡æ¡£: for loops, Android KTX usage example. 12345678910// Example from Android KTXfor(view in viewGroup) &#123; &#125;for(key in sparseArray) &#123;&#125;// Your projectoperator Waterfall.iterator() &#123; // add an iterator to a waterfall class&#125;for(items in myClass) &#123;&#125; // Now waterfall has iterations! Day 18: ç®€å•çš„ Content Valueså°† ContentValues çš„å¼ºå¤§åŠŸèƒ½ä¸ Kotlin çš„ç®€æ´æ€§ç›¸ç»“åˆã€‚ä½¿ç”¨ Android KTX åªä¼ é€’ä¸€ä¸ª Pair &lt;StringKeyï¼ŒValue&gt; åˆ›å»º ContentValuesã€‚Android KTX å®ç°. 123456val contentValues = contentValuesOf( â€œKEY_INTâ€ to 1, â€œKEY_LONGâ€ to 2L, â€œKEY_BOOLEANâ€ to true, â€œKEY_NULLâ€ to null) Day 19: DSLsDSL å¯ä»¥é€šè¿‡ä½¿ç”¨ç±»å‹å®‰å…¨çš„æ„å»ºå™¨æ¥å®Œæˆã€‚å®ƒä»¬ç®€åŒ–äº† API ï¼›ä½ ä¹Ÿå¯ä»¥å€ŸåŠ©extension lambdas å’Œtype safe buildersç­‰åŠŸèƒ½æ¥æ„å»ºå®ƒä»¬ã€‚ 123456789101112html &#123; head &#123; title &#123;+â€This is Kotlin!â€ &#125; &#125; body &#123; h1 &#123;+â€A DSL in Kotlin!â€&#125; p &#123;+â€Itâ€™s ratherâ€ b &#123;+â€bold.â€ &#125; +â€donâ€™t you think?â€ &#125; &#125;&#125; Spek æ˜¯ä¸€ä¸ªæ„å»ºä¸º Kotlin DSL çš„æµ‹è¯•åº“ã€‚Spek ä¸ä½¿ç”¨ @Annotationsï¼Œè€Œæ˜¯æä¾›äº†ä¸€ç§ä¸ä¾èµ–äºåå°„çš„ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥å£°æ˜æµ‹è¯•ä»£ç ã€‚ 12345678910111213@RunWith(JUnitPlatform::class)class MyTest : Spek(&#123; val subject = Subject() given(&quot;it â€™ s on fire&quot;) &#123; subject.lightAFire() it(&quot;should be burning&quot;) &#123; assertTrue(subject.isBurning()) &#125; it(&quot;should not be cold&quot;) &#123; assertFalse(subject.isCold()) &#125; &#125;&#125;) Android ä¸Š Kotlin çš„å¦ä¸€ä¸ª DSL æ˜¯ Ankoã€‚Anko å…è®¸æ‚¨ä½¿ç”¨å£°æ˜æ€§ä»£ç æ„å»º Android è§†å›¾ã€‚ 123456frameLayout &#123; button(&quot;Light a fire&quot;) &#123; onClick &#123; lightAFire() &#125;&#125; Day 20: ç®€å•çš„ Bundleå‡†å¤‡å»é€šè¿‡ç®€æ´çš„æ–¹å¼ï¼ˆbundle creator in Android KTXï¼‰å»åˆ›å»º bundleï¼Œä¸è°ƒç”¨ putStringï¼ŒputIntï¼Œæˆ–å®ƒä»¬çš„ 20 ä¸ªæ–¹æ³•ä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚ä¸€æ¬¡è°ƒç”¨è®©æ‚¨ç”Ÿæˆä¸€ä¸ªæ–°çš„ Bundleï¼Œå®ƒç”šè‡³å¯ä»¥å¤„ç† Arraysï¼ 1234567val bundle = bundleOf( &quot;KEY_INT &quot; *to *1, &quot;KEY_LONG&quot; *to *2L, &quot;KEY_BOOLEAN&quot; *to *true, &quot;KEY_NULL&quot; *to *null &quot;KEY_ARRAY&quot; to arrayOf(1, 2)) Day 21: ç®€åŒ– postDelayedLambdas éå¸¸è´´å¿ƒã€‚ä½¿ç”¨æœ€åä¸€ä¸ªå‚æ•°è°ƒç”¨è¯­æ³•æ‚¨å¯ä»¥å–æ¶ˆå›è°ƒï¼ŒCallable å’Œ Runnable. ä¾‹å¦‚ Android KTX è´´å¿ƒçš„ç”¨ä¸€ä¸ªå°åŒ…è£…æ¥å¤„ç† postDelayedã€‚ 12345678910// Android KTX APIfun Handler.postDelayed( delay: Int, token: Any? = null, action: () -&gt; Unit)// Call it like this â€” no need for a Runnable in your codehandler.postDelayed(50) &#123; // pass a lambda to postDelayed&#125; æœ¬å‘¨é‡ç‚¹ä»‹ç»äº†ä¸€äº›åŸºæœ¬çš„ Kotlin ç‰¹æ€§ï¼Œå¦‚è¿ç®—ç¬¦é‡è½½ï¼Œé¡¶å±‚å‡½æ•°å’Œå‚æ•°ä»¥åŠè¿­ä»£å™¨ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸€ä¸ªé«˜çº§åŠŸèƒ½ï¼šé¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰ï¼Œå¹¶å±•ç¤ºäº†ä½¿ç”¨ Android KTX å¦‚ä½•ç¼–å†™æ›´ç®€æ´çš„ä»£ç ã€‚content values, bundles å’Œ callbacksã€‚ #31 å¤©å­¦ä¹  Kotlin â€” ç¬¬å››å‘¨å›é¡¾ç¬¬ 4 å‘¨å­¦ä¹ æ›´å¤šçš„è¯­è¨€åŸºç¡€çŸ¥è¯†ï¼Œç„¶ååœ¨æŸæ–¹é¢ä½¿ç”¨ Android KTX ä½¿æ‚¨çš„ä»£ç æ›´ç®€æ´å’Œå¯è¯»ï¼ Day 22: åœ¨ Java è¯­è¨€ä¸­è°ƒç”¨ Kotlinåœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ Kotlin å’Œ Javaï¼Ÿä½ æœ‰æ²¡æœ‰é¡¶å±‚å‡½æ•°æˆ–å±æ€§çš„ç±»å‘¢ï¼Ÿé»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å°†ç”Ÿæˆç±»åä¸º YourFileKt çš„ç±»ã€‚é€šè¿‡ä½¿ç”¨ @fileï¼šJvmName æ³¨é‡Šæ–‡ä»¶æ¥æ›´æ”¹å®ƒã€‚æ–‡æ¡£: package level functions 123456789101112131415161718// File: ShapesGenerator.ktpackage com.shapesfun generateSquare(): Square &#123;â€¦&#125;fun generateTriangle(): Triangle &#123;â€¦&#125;// Java usage:Square square = ShapesGeneratorKt.generateSquare();// File: ShapesGenerator.kt@file:JvmName(â€œShapesGeneratorâ€)package com.shapesfun generateSquare(): Square &#123;â€¦&#125;fun generateTriangle(): Triangle &#123;â€¦&#125;// Java usage:Square square = ShapesGenerator.generateSquare(); Day 23: å…·ä½“åŒ–å…·ä½“åŒ–æ¦‚å¿µçš„ä¸€ä¸ªä¾‹å­ï¼šAndroid KTX ä¸­çš„ Context.systemService() ä½¿ç”¨æ³›åŒ–é€šè¿‡æ³›å‹ä¼ é€’ â€œçœŸå®â€ ç±»å‹ã€‚æ²¡æœ‰é€šè¿‡ getSystemServiceã€‚æ–‡æ¡£: reified type parameters Android KTX: Context.systemService() 12345678910// the old wayval alarmManager = context.getSystemService(AlarmManager::class.java)// the reified wayval alarmManager: AlarmManager = context.systemService()// the magic from Android KTXâ€¦ with â€œrealâ€ type Tinline fun Context.systemService() = getSystemService(T::class.java) Day 24: Delegatesé€šè¿‡ by æŠŠä½ çš„å·¥ä½œå§”æ‰˜ç»™å¦ä¸€ä¸ªç±»ã€‚é€šè¿‡ç±»ç»§æ‰¿ï¼Œå¹¶å°†å±æ€§è®¿é—®å™¨é€»è¾‘ä¸å§”æ‰˜è€…å±æ€§é‡ç”¨ã€‚ æ–‡æ¡£: delegation and delegated properties 123456789101112131415161718class MyAnimatingView : View( /* â€¦ */ ) &#123; // delegated property. // Uses the getter and setter defined in InvalidateDelegate var foregroundX by InvalidateDelegate(0f)&#125;// A View Delegate which invalidates// View.postInvalidateOnAnimation when set.class InvalidateDelegate(var value: T) &#123; operator fun getValue(thisRef: View, property: KProperty&lt;*&gt;) = value operator fun setValue(thisRef: View, property: KProperty&lt;*&gt;, value: T) &#123; this.value = value thisRef.postInvalidateOnAnimation() &#125;&#125; Day 25: æ‰©å±•å‡½æ•°æ²¡æœ‰æ›´å¤šçš„ Util ç±»ã€‚é€šè¿‡æ‰©å±•å‡½æ•°æ¥æ‰©å±•ç±»çš„åŠŸèƒ½ã€‚æŠŠä½ è¦æ‰©å±•çš„ç±»çš„åå­—æ”¾åœ¨ä½ æ·»åŠ çš„æ–¹æ³•çš„åå­—å‰é¢ã€‚ æ–‡æ¡£: extension functions æ‰©å±•åŠŸèƒ½çš„ä¸€äº›ç‰¹æ€§ï¼š ä¸æ˜¯æˆå‘˜å‡½æ•° ä¸ä»¥ä»»ä½•æ–¹å¼ä¿®æ”¹åŸå§‹ç±» é€šè¿‡é™æ€ç±»å‹ä¿¡æ¯è§£å†³ç¼–è¯‘æ—¶é—´ ä¼šè¢«ç¼–è¯‘ä¸ºé™æ€å‡½æ•° ä¸æ˜¯å¤šæ€ ä¾‹å¦‚ï¼š String.toUri() 12345// Extend String with toUriinline fun String.toUri(): Uri = Uri.parse(this)// And call it on any String!val myUri = â€œwww.developer.android.com&quot;.toUri() Day 26: Drawable.toBitmap() è½»æ¾è½¬æ¢å¦‚æœä½ æ›¾ç»å°† Drawable è½¬æ¢ä¸º Bitmapï¼Œé‚£ä¹ˆä½ éœ€è¦å¤šå°‘æ ·æ¿ä»£ç å‘¢ï¼Ÿ Android KTX å…·æœ‰ä¸€ç³»åˆ—åŠŸèƒ½ï¼Œå¯ä»¥ä½¿æ‚¨çš„ä»£ç åœ¨ä½¿ç”¨ graphics åŒ…ä¸­ç±»æ—¶æ›´åŠ ç®€æ´ã€‚ æ–‡æ¡£: graphics 12345// get a drawable from resourcesval myDrawable = ContextCompat.getDrawable(context, R.drawable.icon)// convert the drawable to a bitmapval bitmap = myDrawable.toBitmap() Day 27: Sequences, lazy å’Œ generatorsåºåˆ—æ˜¯ä»æœªå­˜åœ¨çš„åˆ—è¡¨ã€‚åºåˆ—æ˜¯è¿­ä»£å™¨çš„è¡¨äº²ï¼Œä¸€æ¬¡åªèƒ½æ‡’æ•£åœ°äº§ç”Ÿä¸€ä¸ªå€¼ã€‚è¿™åœ¨ä½¿ç”¨ map å’Œ fifter æ—¶éå¸¸é‡è¦ - å®ƒä»¬å°†åˆ›å»ºåºåˆ—ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸€æ­¥éƒ½å¤åˆ¶åˆ—è¡¨ï¼æ–‡æ¡£: sequences 123456val sequence = List(50) &#123; it * 5 &#125;.asSequence()sequence.map &#123; it * 2 &#125; // lazy (iterate 1 element) .filter &#123; it % 3 == 0 &#125; // lazy (iterate 1 element) .map &#123; it + 1 &#125; // lazy (iterate 1 element) .toList() // eager (make a new list) ä½ å¯ä»¥ä»åˆ—è¡¨ä¸­åˆ›å»ºåºåˆ—æˆ–æŒ‡å®šä¸‹ä¸€ä¸ªåŠŸèƒ½ã€‚å¦‚æœæ‚¨æ°¸è¿œä¸ä¼šç»ˆæ­¢ä¸€ä¸ªåºåˆ—ï¼Œå®ƒå¯ä»¥æ˜¯æ— é™é•¿çš„è€Œä¸ä¼šè€—å°½å†…å­˜ã€‚ä½¿ç”¨ Kotlin ä¸­çš„åç¨‹ä¹Ÿå¯ä»¥ç”¨ç”Ÿæˆå™¨ï¼ æ–‡æ¡£: generators 123456789101112// make a sequence from a listlist.asSequence().filter &#123; it == â€œlazyâ€ &#125;// or, reach infinity functionallyval natural = generateSequence(1) &#123; it + 1 &#125;// or, cooperate with coroutinesval zeros = buildSequence &#123; while (true) &#123; yield (0) &#125;&#125; Day 28: æ›´ç®€å•çš„ spansåŠŸèƒ½å¼ºå¤§ä½†æ˜¯å¾ˆéš¾ä½¿ç”¨ - è¿™å°±æ˜¯ text styel Spans API ç»™äººçš„æ„Ÿè§‰ã€‚ Android KTX ä¸ºä¸€äº›æœ€å¸¸è§çš„ span æ·»åŠ äº†æ‰©å±•åŠŸèƒ½ï¼Œå¹¶ä½¿ API æ›´æ˜“äºä½¿ç”¨ã€‚Android KTX: spannable string builder 12345678910val string = buildSpannedString &#123; append(â€œno styling textâ€) bold &#123; append(â€œboldâ€) italic &#123; append(â€œbold and italicâ€) &#125; &#125; inSpans(RelativeSizeSpan(2f), QuoteSpan())&#123; append(â€œdouble sized quote textâ€) &#125;&#125; Day 29: Parcelizeå–œæ¬¢ Parcelable çš„é€Ÿåº¦ï¼Œä½†ä¸å–œæ¬¢å†™æ‰€æœ‰çš„ä»£ç ï¼Ÿå’Œ @Parcelize æ‰“ä¸ªæ‹›å‘¼å§ã€‚Spec: Parcelize 123456789@Parcelizedata class User(val name: String, val occupation: Work): Parcelable// build.gradleandroidExtensions &#123; //Enable experimental Kotlin features // in gradle to enable Parcelize experimental = true&#125; Day 30: updatePadding æ‰©å±•é€šè¿‡é»˜è®¤å‚æ•°æ‰©å±•ç°æœ‰çš„ API é€šå¸¸ä¼šè®©äººæ„Ÿåˆ°é«˜å…´ã€‚ Android KTX å…è®¸ä½ ä½¿ç”¨é»˜è®¤å‚æ•°åœ¨ View çš„ä¸€ä¾§è®¾ç½® Paddingã€‚ä¸€ä¸ªå‡½æ•°å¯ä»¥èŠ‚çœå¾ˆå¤šä»£ç ï¼ Android KTX: View.updatePadding 12345view.updatePadding(left = newPadding)view.updatePadding(top = newPadding)view.updatePadding(right = newPadding)view.updatePadding(bottom = newPadding)view.updatePadding(top = newPadding, bottom = newPadding) Day 31: èŒƒå›´å¤– run, let, with, applyè®©æˆ‘ä»¬è¿è¡Œä¸€äº›æ ‡å‡†çš„ Kotlin å‡½æ•°ï¼ç®€çŸ­è€Œå¼ºå¤§ï¼Œrunï¼Œletï¼Œwith å’Œ appy éƒ½æœ‰ä¸€ä¸ªæ¥æ”¶å™¨ (this)ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªå‚æ•° (it) å¹¶å¯èƒ½æœ‰ä¸€ä¸ªè¿”å›å€¼ã€‚å·®å¼‚å¦‚ä¸‹ï¼š run 1234567val string = â€œaâ€val result = string.run &#123; // this = â€œaâ€ // it = not available 1 // Block return value // result = 1&#125; let 1234567val string = â€œaâ€val result = string.let &#123; // this = this@MyClass // it = â€œaâ€ 2 // Block return value // result = 2&#125; with 1234567val string = â€œaâ€val result = with(string) &#123; // this = â€œaâ€ // it = not available 3 // Block return value // result = 3&#125; apply 1234567val string = â€œaâ€val result = string.apply &#123; // this = â€œaâ€ // it = not available 4 // Block return value unused // result = â€œaâ€&#125; æœ¬å‘¨ä»‹ç»äº†ä¸€äº›è¯­è¨€ç‰¹æ€§ï¼Œä¾‹å¦‚ interopï¼Œrefied å’Œ sequenceï¼Œç„¶åæˆ‘ä»¬è½¬å‘ Android KTXï¼Œå±•ç¤ºäº†å®ƒå¸®åŠ©ä½ ç¼–å†™ç®€æ´æ˜“è¯»çš„ä»£ç çš„ä¸€äº›æ–¹æ³•ã€‚ ä¸ºäº†å®Œæˆè¿™ä¸ªç³»åˆ—ï¼Œæˆ‘ä»¬ä»‹ç»äº†åŠŸèƒ½å¼ºå¤§çš„ Kotlin scope å‡½æ•°ã€‚","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"http://www.imzhiqiang.com/tags/Kotlin/"}]},{"title":"åº”ç”¨å†…èµ„æºæ–‡ä»¶ä¼˜åŒ–","date":"2019-03-02T12:41:03.000Z","path":"2019/03/02/In-app-resource-opt/","text":"ä½¿ç”¨ lint æ£€æŸ¥æ— ç”¨èµ„æºä½¿ç”¨lintæ£€æµ‹å·¥å…·æ£€æŸ¥æ— ç”¨ä»£ç ï¼Œæ³¨æ„ä¸è¦ä½¿ç”¨ä¸€é”®åˆ é™¤ï¼Œé¿å…ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜: é€šè¿‡åå°„è·å–èµ„æºï¼Œå¯ä»¥å°†åå°„èµ„æºåŠ å…¥lint.xmlï¼Œé¿è¿‡lintæ£€æµ‹ koltinç›®å‰å¯¹lintæ£€æµ‹æ”¯æŒå¹¶ä¸å‹å¥½ ä½¿ç”¨ Gradle æ’ä»¶å‹ç¼©å›¾ç‰‡åˆ©ç”¨ Gradle æ’ä»¶æˆ‘ä»¬å¯ä»¥åœ¨æ‰“åŒ…æ—¶æŠŠä¸€äº›è¾ƒå¤§çš„å›¾ç‰‡èµ„æºå‹ç¼©ï¼Œä»è€Œè¾¾åˆ°ç˜¦èº«çš„ç›®çš„ã€‚æ’ä»¶é¡¹ç›®åœ°å€åŠ å…¥å‹ç¼©å›¾ç‰‡èµ„æºæ’ä»¶, å°†é“¾æ¥ä¸­çš„æ–‡ä»¶ç½®äºå·¥ç¨‹ç›®å½•ä¸‹ï¼ŒåŒæ—¶åœ¨é¡¹ç›®ä¸­åŠ å…¥ä¸€ä¸‹é…ç½® 1234567891011121314151617181920212223//project build.gradledependencies &#123; classpath &#x27;com.smallsoho.mobcase:McImage:1.5.1&#x27;&#125;// app build.gradleapply plugin: &#x27;McImage&#x27;McImageConfig &#123; isCheckSize true //Whether to detect image sizeï¼Œdefault true optimizeType &quot;Compress&quot; //Optimize Typeï¼Œ&quot;ConvertWebp&quot; or &quot;Compress&quot;ï¼Œdefault &quot;Compress&quot;, &quot;CompressWebp&quot; is a better compression ratio but it don&#x27;t support api &lt; 18 maxSize 1*1024*1024 //big image size thresholdï¼Œdefault 1MB enableWhenDebug false //switch in debug buildï¼Œdefault true isCheckPixels true // Whether to detect image pixels of width and heightï¼Œdefault true maxWidth 1000 //default 1000 maxHeight 1000 //default 1000 whiteList = [ //do not do any optimization for the images who in the list &quot;icon_launcher.png&quot; ] mctoolsDir &quot;$rootDir&quot; isSupportAlphaWebp false //Whether support convert the Image with Alpha chanel to Webpï¼Œdefault false, the images with alpha chanels will be compressed.if config true, its need api level &gt;=18 or do some compatible measures multiThread true //Whether open multi-thread processingï¼Œdefault true bigImageWhiteList = [] //do not detect big size or large pixels for the images who in the list&#125; ä½¿ç”¨å¾®ä¿¡çš„ AndResGuard æ··æ·†å‹ç¼©èµ„æºæ–‡ä»¶AndResGuard å¯ä»¥å®ç°èµ„æºæ··æ·†ï¼ŒæŠŠå†—é•¿çš„èµ„æºè·¯å¾„å˜çŸ­ï¼Œä»è€Œå‡å° apk çš„å¤§å°ã€‚ ä½¿ç”¨Gradleæ’ä»¶ä½¿ç”¨wxçš„AndResGuardæ’ä»¶, é…ç½®å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657//project build.gradledependencies &#123; classpath &#x27;com.tencent.mm:AndResGuard-gradle-plugin:1.2.21&#x27; &#125; // app build.gradleapply plugin: &#x27;AndResGuard&#x27;andResGuard &#123; // mappingFile = file(&quot;./resource_mapping.txt&quot;) mappingFile = null use7zip = true useSign = true // It will keep the origin path of your resources when it&#x27;s true keepRoot = false // If set, name column in arsc those need to proguard will be kept to this value fixedResName = &quot;arg&quot; // It will merge the duplicated resources, but don&#x27;t rely on this feature too much. // it&#x27;s always better to remove duplicated resource from repo mergeDuplicatedRes = true whiteList = [ // your icon &quot;R.drawable.icon&quot;, // for fabric &quot;R.string.com.crashlytics.*&quot;, // for google-services &quot;R.string.google_app_id&quot;, &quot;R.string.gcm_defaultSenderId&quot;, &quot;R.string.default_web_client_id&quot;, &quot;R.string.ga_trackingId&quot;, &quot;R.string.firebase_database_url&quot;, &quot;R.string.google_api_key&quot;, &quot;R.string.google_crash_reporting_api_key&quot;, &quot;R.string.project_id&quot;, ] compressFilePattern = [ &quot;*.png&quot;, &quot;*.jpg&quot;, &quot;*.jpeg&quot;, &quot;*.gif&quot;, ] sevenzip &#123; artifact = &#x27;com.tencent.mm:SevenZip:1.2.21&#x27; //path = &quot;/usr/local/bin/7za&quot; &#125; /** * Optional: if finalApkBackupPath is null, AndResGuard will overwrite final apk * to the path which assemble[Task] write to **/ // finalApkBackupPath = &quot;$&#123;project.rootDir&#125;/final.apk&quot; /** * Optional: Specifies the name of the message digest algorithm to user when digesting the entries of JAR file * Only works in V1signing, default value is &quot;SHA-1&quot; **/ // digestalg = &quot;SHA-256&quot;&#125; ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·å‚è€ƒå®˜æ–¹æ–‡æ¡£ ä½¿ç”¨Webpæ›¿æ¢png/jpgä½¿ç”¨Android Studioè‡ªå¸¦çš„å·¥å…·å¯ä»¥å¾ˆæ–¹ä¾¿æŠŠé¡¹ç›®ä¸­çš„pngå’Œjpgæ›¿æ¢ä¸ºwebpã€‚è¯¦è§ä¸‹å›¾ï¼š ä½¿ç”¨tinypngå‹ç¼©png/jpgå¯¹äºminSdkVersion &lt; 18 çš„App,ä¸èƒ½å°†å¸¦æœ‰Alphaé€šé“çš„pngå›¾ç‰‡è½¬æˆwebp,éœ€è¦ä½¿ç”¨tinypngè¿›è¡Œå›¾ç‰‡å‹ç¼©ã€‚tinypngå®˜æ–¹æä¾›äº†åœ¨çº¿å‹ç¼©çš„æ–¹å¼ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æ˜æ˜¾ä¸é€‚åˆæˆ‘ä»¬çš„Androidå·¥ç¨‹ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å¼€æºçš„å‘½ä»¤è¡Œå·¥å…·tinypng-cliæ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆå‹ç¼©æ›¿æ¢çš„å·¥ä½œã€‚ ç”±äºtinypng-cliä¾èµ–äºnodejsï¼Œæ‰€ä»¥è¦å…ˆå®‰è£…nodejsã€‚ä¸‹è½½åœ°å€ï¼šhttps://nodejs.org/en/download/ ä½¿ç”¨npmå®‰è£…tinypng-cliã€‚1npm install -g tinypng-cli å‘tinypngç”³è¯·API Key,åªéœ€å¡«å†™åå­—å’Œé‚®ç®±å³å¯ã€‚ è®¾ç½®å…¨å±€çš„API Key:åœ¨å½“å‰ç”¨æˆ·çš„homeç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ª.tinypngçš„æ–‡ä»¶ï¼Œå°†ç”³è¯·çš„APK Keyå†™å…¥è¯¥æ–‡ä»¶ã€‚ è¿›å…¥è¦å‹ç¼©çš„ç›®å½•ï¼Œè¿è¡Œå‘½ä»¤ï¼Œå¤§åŠŸå‘Šæˆï¼æ›´å¤šç”¨æ³•å‚è€ƒï¼šhttps://github.com/websperts/tinypng-cli#usage","tags":[]},{"title":"ä½¿ç”¨ACTION_IMAGE_CAPTUREå¯èƒ½å­˜åœ¨çš„é£é™©","date":"2017-09-04T03:16:11.000Z","path":"2017/09/04/action-image-capture-issue/","text":"å¾ˆå¤šçš„ Android App ä¸­éƒ½æœ‰ä½¿ç”¨ç›¸æœºæ‹æ‘„ç”¨æˆ·å¤´åƒçš„åŠŸèƒ½ã€‚å¤§éƒ¨åˆ†å¼€å‘è€…éƒ½ä¼šä½¿ç”¨MediaStore.ACTION_IMAGE_CAPTUREæ¥æ»¡è¶³è¿™ä¸€éœ€æ±‚ã€‚è¿™å¯ä»¥èŠ‚çœå¾ˆå¤šæ—¶é—´ï¼Œä¸éœ€è¦å•ç‹¬å¼€å‘ç›¸æœº UIï¼Œç›´æ¥è°ƒç”¨ç³»ç»Ÿç›¸æœºï¼›ä¸éœ€è¦å‘ç³»ç»Ÿè¯·æ±‚ Camera æƒé™ã€‚æ­£å¦‚å®˜æ–¹æ–‡æ¡£é‡Œé¢è¯´çš„é‚£æ ·ï¼ŒTaking Photos Simplyã€‚ç„¶è€Œåœ¨æœ€è¿‘çš„ä¸€æ¬¡çš„æµ‹è¯•ä¸­ï¼Œæˆ‘å‘ç°å¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•ã€‚å› ä¸ºè¿è¡Œäº†å‡ å¹´çš„ä»£ç ç«Ÿç„¶å‘ç”Ÿäº† Crashã€‚å…·ä½“çš„ log å¦‚ä¸‹ï¼š java.lang.SecurityException: Permission Denial: starting Intent { act=android.media.action.IMAGE_CAPTURE cat=[android.intent.category.DEFAULT] flg=0x3 cmp=com.google.android.GoogleCamera/com.android.camera.activity.CaptureActivity clip={text/uri-list U:content://com.imzhiqiang.example.fileprovider/imageCache/tmp_avatar.jpg} (has extras) } from ProcessRecord{bf70afd 18107:com.imzhiqiang.example/u0a108} (pid=18107, uid=10108) with revoked permission android.permission.CAMERA çœ‹ä¸Šå»æ˜¯å› ä¸ºæ²¡æœ‰å¤„ç†è¿è¡Œæ—¶æƒé™å¯¼è‡´çš„ Crashã€‚Interesting! æˆ‘å¹¶æ²¡æœ‰åœ¨ manifest æ–‡ä»¶ä¸­å£°æ˜ Camera çš„æƒé™ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°æ²¡æœ‰å¤„ç† Camera è¿è¡Œæ—¶æƒé™çš„é—®é¢˜å‘¢ï¼Ÿéšåæˆ‘æƒ³åˆ°äº†å¯èƒ½æ˜¯å¼•ç”¨çš„ library ä¸­å£°æ˜äº†è¯¥æƒé™ã€‚åœ¨ Android Studio ä¸­æŸ¥çœ‹äº† Merged Manifestï¼Œæœç„¶æ˜¯è¿™æ ·ã€‚å›¾ä¸­æ·±è‰²èƒŒæ™¯çš„æƒé™æ˜¯æˆ‘è‡ªå·±å£°æ˜çš„ï¼Œä¸‹é¢çš„æƒé™æ˜¯ç¬¬ä¸‰æ–¹çš„ library å£°æ˜çš„ã€‚ ç„¶è€Œè¿™å’Œ Intent åˆæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿä½¿ç”¨ ACTION_IMAGE_CAPTURE ä¸æ˜¯å¯ä»¥é¿å…è¯·æ±‚ Camera æƒé™å—ï¼Ÿç»è¿‡å‡ ç•ªå‘¨æŠ˜è¿‡åï¼Œæœ€åç»ˆäºåœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°äº†ç­”æ¡ˆã€‚ è™½ç„¶å¾ˆéš¾ç†è§£ Google è¿™æ ·çš„åšæ³•ï¼Œä¸è¿‡æ€»ç®—æ‰¾åˆ°äº†é—®é¢˜çš„æ ¹æœ¬æ‰€åœ¨ã€‚åœ¨å¯¹ Camera æƒé™è¿›è¡Œæ­£ç¡®çš„å¤„ç†åï¼Œç»ˆäºæ­£å¸¸è¿è¡Œäº†ã€‚ ç»“è®º å¦‚æœæ²¡æœ‰åœ¨ manifest æ–‡ä»¶ä¸­å£°æ˜ Camera æƒé™ï¼Œä½¿ç”¨ ACTION_IMAGE_CAPTURE ä¸éœ€è¦å¯¹ Camera æƒé™åšè¿è¡Œæ—¶æƒé™å¤„ç†ï¼Œä»£ç æ­£å¸¸è¿è¡Œã€‚å¦‚æœå£°æ˜äº†å°±å¿…é¡»è¦åšæƒé™å¤„ç†ã€‚ ä½¿ç”¨ Intent çš„ action æ—¶ï¼Œä¸€å®šè¦ä»”ç»†é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼Œé¿å…ç±»ä¼¼çš„é£é™©ã€‚ å¼•ç”¨ç¬¬ä¸‰æ–¹ library æ—¶ï¼Œé™¤äº†ç†Ÿæ‚‰å…¶å†…éƒ¨åŸç†å’Œæºç å¤–ï¼Œè¿˜è¦æ³¨æ„å®ƒåœ¨ manifest æ–‡ä»¶ä¸­æ·»åŠ çš„ä¸œè¥¿ã€‚ æ‰©å±•é˜…è¯» Taking Photos Not So Simply: How I Got Bitten By ACTION_IMAGE_CAPTURE Use intent ACTION_IMAGE_CAPTURE to launch camera app requires CAMERA permission The ACTION_IMAGE_CAPTURE Fallacy","tags":[{"name":"Image Capture","slug":"Image-Capture","permalink":"http://www.imzhiqiang.com/tags/Image-Capture/"}]},{"title":"Glideä¸­çš„ç¼“å­˜","date":"2017-03-05T07:49:32.000Z","path":"2017/03/05/Cache-in-Glide/","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¦‚ä½•é…ç½®å’Œç®¡ç† Glide ä¸­çš„ç¼“å­˜ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†å†…å®¹éƒ½å¯ä»¥ç›´æ¥åœ¨å®˜æ–¹ Wiki ä¸­æ‰¾åˆ°ï¼Œè¿™é‡Œåªæ˜¯è¿›è¡Œäº†æ•´ç†å’Œæ±‡æ€»ã€‚è¨€å½’æ­£ä¼ ï¼ŒGlide æ”¯æŒå›¾ç‰‡çš„äºŒçº§ç¼“å­˜(å¹¶ä¸æ˜¯ä¸‰çº§ç¼“å­˜ï¼Œå› ä¸ºä»ç½‘ç»œåŠ è½½å¹¶ä¸å±äºç¼“å­˜)ï¼Œå³å†…å­˜ç¼“å­˜å’Œç£ç›˜ç¼“å­˜ã€‚ ç£ç›˜ç¼“å­˜ä¸€èˆ¬çš„å›¾ç‰‡ç¼“å­˜æŒ‡çš„å°±æ˜¯ç£ç›˜ç¼“å­˜ï¼ŒæŠŠç½‘ç»œä¸Šçš„å›¾ç‰‡ç¼“å­˜åˆ°æœ¬åœ°ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡éƒ½ä»ç½‘ç»œåŠ è½½ï¼Œæ—¢æé«˜äº†åŠ è½½é€Ÿåº¦ï¼Œåˆä¸ºç”¨æˆ·èŠ‚çœäº†æµé‡ã€‚Glide åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼€å¯ç£ç›˜ç¼“å­˜çš„ï¼Œè€Œä¸”æä¾›äº†ä¸°å¯Œçš„ API æ¥è®©å¼€å‘è€…è‡ªå·±é…ç½®å’Œç®¡ç†ç£ç›˜ç¼“å­˜ã€‚ ç¼“å­˜ä½ç½®å’Œå¤§å°å¼€å‘è€…å¯ä»¥é€šè¿‡æ„å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„GlideModuleæ¥é…ç½® Glide ç£ç›˜ç¼“å­˜çš„ä½ç½®å’Œå¤§å°ã€‚æœ€ç®€å•çš„æ–¹æ³•å¦‚ä¸‹ï¼š 1234567891011121314public class DiskCacheMoudle implements GlideModule &#123; @Override public void applyOptions(Context context, GlideBuilder builder) &#123; builder.setDiskCache( new InternalCacheDiskCacheFactory(context, &quot;glide_cache&quot;, 100 * 1024 * 1024)); //builder.setDiskCache( // new ExternalCacheDiskCacheFactory(context, &quot;glide_cache&quot;, 100 * 1024 * 1024)); &#125; @Override public void registerComponents(Context context, Glide glide) &#123; &#125;&#125; å…¶ä¸­ InternalCache å’Œ ExternalCache éƒ½æœ€å¤šæ¥æ”¶ 3 ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°ä¸º Context,æ²¡å•¥å¥½è¯´çš„ï¼›ç¬¬äºŒä¸ªä¸ºç¼“å­˜çš„ç›®å½•åç§°ï¼›ç¬¬ä¸‰ä¸ªä¸ºç¼“å­˜å¤§å°ï¼Œå•ä½æ˜¯ Byteã€‚å®ƒä»¬ä¹‹é—´å”¯ä¸€çš„ä¸åŒå°±åœ¨äº InternalCache æ„å»ºçš„ç¼“å­˜æ˜¯åœ¨åº”ç”¨çš„å†…éƒ¨å‚¨å­˜ï¼Œè€Œ ExternalCache åˆ™æ˜¯åœ¨å¤–éƒ¨å‚¨å­˜ã€‚å†…éƒ¨å‚¨å­˜ä¸­çš„ç¼“å­˜æ–‡ä»¶æ˜¯å…¶ä»–åº”ç”¨ç¨‹åºæ˜¯æ— æ³•è·å–åˆ°çš„ï¼Œæ›´åŠ å®‰å…¨ã€‚å…³äºå†…éƒ¨å‚¨å­˜å’Œå¤–éƒ¨å‚¨å­˜çš„æ›´å¤šå†…å®¹ï¼Œè¯·ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ å¦‚æœä¸æƒ³æŠŠç¼“å­˜æ”¾åœ¨ä¸Šé¢çš„ä¸¤ä¸ªä½ç½®æ€ä¹ˆåŠï¼ŸGlide å½“ç„¶ä¹Ÿæ”¯æŒï¼Œå…·ä½“é€šè¿‡ DiskLruCacheFactory æ¥å®ç°ï¼š 1234567builder.setDiskCache( new DiskLruCacheFactory(new DiskLruCacheFactory.CacheDirectoryGetter() &#123; @Override public File getCacheDirectory() &#123; return getMyCacheLocationBlockingIO(); &#125; &#125;), 100 * 1024 * 1024); Note: getMyCacheLocationBlockingIO æ–¹æ³•è¿”å›çš„æ–‡ä»¶ä¸èƒ½ä¸ºç©ºï¼Œè€Œä¸”å¿…é¡»æ˜¯ä¸€ä¸ªå·²ç»åˆ›å»ºå¥½çš„æ–‡ä»¶ç›®å½•ï¼Œä¸å¯ä»¥æ˜¯æ–‡ä»¶ã€‚ ç¼“å­˜ç­–ç•¥ä¸å…¶ä»–å›¾ç‰‡åŠ è½½åº“çš„ç¼“å­˜æœºåˆ¶ä¸åŒï¼ŒGlide ç¼“å­˜å›¾ç‰‡æ—¶é»˜è®¤åªç¼“å­˜æœ€ç»ˆåŠ è½½çš„é‚£å¼ å›¾ç‰‡ã€‚ä¸¾ä¸ªæ —å­ï¼Œä½ è¦åŠ è½½çš„å›¾ç‰‡åˆ†è¾¨ç‡ä¸º 1000x1000ï¼Œä½†æ˜¯æœ€ç»ˆæ˜¾ç¤ºè¯¥å›¾ç‰‡çš„ ImageView å¤§å°åªæœ‰ 500x500ï¼Œé‚£ä¹ˆ Glide å°±ä¼šåªç¼“å­˜ 500x500 çš„å°å›¾ã€‚è¿™ä¹Ÿæ˜¯åœ¨ä»ç£ç›˜ç¼“å­˜ä¸­åŠ è½½å›¾ç‰‡æ—¶ Glide æ¯” Picasso å¿«çš„åŸå› ã€‚Glide ç›®å‰æä¾›äº†å››ç§ç¼“å­˜ç­–ç•¥ï¼š DiskCacheStrategy.NONE ä¸ç¼“å­˜æ–‡ä»¶ DiskCacheStrategy.SOURCE åªç¼“å­˜åŸå›¾ DiskCacheStrategy.RESULT åªç¼“å­˜æœ€ç»ˆåŠ è½½çš„å›¾ï¼ˆé»˜è®¤çš„ç¼“å­˜ç­–ç•¥ï¼‰ DiskCacheStrategy.ALL åŒæ—¶ç¼“å­˜åŸå›¾å’Œç»“æœå›¾ ç¼“å­˜ç®—æ³•åœ¨ Glide ä¸­ç£ç›˜ç¼“å­˜é»˜è®¤ä½¿ç”¨çš„æ˜¯ LRUï¼ˆLeast Recently Usedï¼‰ç®—æ³•ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨å…¶ä»–çš„ç¼“å­˜ç®—æ³•ï¼Œå°±åªèƒ½é€šè¿‡å®ç° DiskCache æ¥å£æ¥å®Œæˆäº†ã€‚ å†…å­˜ç¼“å­˜ä½¿ç”¨å†…å­˜ç¼“å­˜å¯ä»¥è·å¾—æ›´å¿«çš„å›¾ç‰‡åŠ è½½é€Ÿåº¦ï¼Œå› ä¸ºå‡å°‘äº†è€—æ—¶çš„ IO æ“ä½œã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒBitmap æ˜¯ Android ä¸­çš„å†…å­˜å¤§æˆ·ï¼Œé¢‘ç¹çš„åˆ›å»ºå’Œå›æ”¶ Bitmap å¿…ç„¶ä¼šå¼•èµ·å†…å­˜æŠ–åŠ¨ã€‚Glide ä¸­æœ‰ä¸€ä¸ªå«åš BitmapPool çš„ç±»ï¼Œå¯ä»¥å¤ç”¨å…¶ä¸­çš„ Bitmap å¯¹è±¡ï¼Œä»è€Œé¿å… Bitmap å¯¹è±¡çš„åˆ›å»ºï¼Œå‡å°å†…å­˜å¼€é”€ã€‚å½“é…ç½®å†…å­˜ç¼“å­˜æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥åŒæ—¶é…ç½® BitmapPool çš„å¤§å°ã€‚å…·ä½“æ–¹æ³•ä¹Ÿæ˜¯é€šè¿‡è‡ªå®šä¹‰çš„ GlideModule æ¥å®ç°çš„ï¼š 12builder.setMemoryCache(new LruResourceCache(yourSizeInBytes));builder.setBitmapPool(new LruBitmapPool(sizeInBytes)); ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¼€å‘è€…æ˜¯ä¸éœ€è¦è‡ªå·±å»æŒ‡å®šå®ƒä»¬çš„å¤§å°çš„ï¼Œå› ä¸º Glide å·²ç»å¸®æˆ‘ä»¬åšå¥½äº†ã€‚é»˜è®¤çš„å†…å­˜ç¼“å­˜å’Œ bitmapPool çš„å¤§å°ç”±MemorySizeCalculatoræ ¹æ®å½“å‰è®¾å¤‡çš„å±å¹•å¤§å°å’Œå¯ç”¨å†…å­˜è®¡ç®—å¾—åˆ°ã€‚åŒæ—¶ Glide è¿˜æ”¯æŒåŠ¨æ€çš„ç¼“å­˜å¤§å°è°ƒæ•´ï¼Œåœ¨å­˜åœ¨å¤§é‡å›¾ç‰‡çš„ Activity/Fragment ä¸­ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ setMemoryCategory æ–¹æ³•æ¥æé«˜ Glide çš„å†…å­˜ç¼“å­˜å¤§å°ï¼Œä»è€ŒåŠ å¿«å›¾ç‰‡çš„åŠ è½½é€Ÿåº¦ã€‚ 1Glide.get(context).setMemoryCategory(MemoryCategory.HIGH); MemoryCategory æœ‰ 3 ä¸ªå€¼å¯ä¾›é€‰æ‹©ï¼š MemoryCategory.HIGHï¼ˆåˆå§‹ç¼“å­˜å¤§å°çš„ 1.5 å€ï¼‰ MemoryCategory.NORMALï¼ˆåˆå§‹ç¼“å­˜å¤§å°çš„ 1 å€ï¼‰ MemoryCategory.LOWï¼ˆåˆå§‹ç¼“å­˜å¤§å°çš„ 0.5 å€ï¼‰ åœ¨æœ‰äº›æƒ…å†µä¸‹æˆ‘ä»¬ä¸å¸Œæœ›åšå†…å­˜ç¼“å­˜ï¼ˆæ¯”å¦‚åŠ è½½ GIF å›¾ç‰‡ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è°ƒç”¨ skipMemoryCache(true)æ–¹æ³•è·³è¿‡å†…å­˜ç¼“å­˜ã€‚ å¦‚ä½•ç¼“å­˜åŠ¨æ€ Url çš„å›¾ç‰‡ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä»ç½‘ç»œä¸Šè·å–åˆ°çš„å›¾ç‰‡ Url éƒ½æ˜¯é™æ€çš„ï¼Œå³ä¸€å¼ å›¾ç‰‡å¯¹åº”ä¸€ä¸ª Urlã€‚é‚£ä¹ˆå¦‚æœæ˜¯ä¸€å¼ å›¾ç‰‡å¯¹åº”å¤šä¸ª Url å‘¢ï¼Ÿç¼“å­˜ä¸å°±æ²¡æœ‰æ„ä¹‰äº†ã€‚å› ä¸ºå›¾ç‰‡åŠ è½½åº“éƒ½æ˜¯æ‹¿å›¾ç‰‡çš„ Url æ¥ä½œä¸ºç¼“å­˜çš„ key çš„ï¼ŒGlide ä¹Ÿä¸ä¾‹å¤–ï¼Œåªæ˜¯ä¼šæ›´åŠ å¤æ‚ä¸€äº›ã€‚å¦‚æœä½ å¼€å¯äº† Glide çš„ log,å°±ä¼šåœ¨æ§åˆ¶å°çœ‹åˆ° Glide æ˜¯å¦‚ä½•æŒ‡å®šç¼“å­˜ key çš„ã€‚å…³äºå¦‚ä½•æ‰“å¼€ log,è¯·å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒGlide çš„ key ç”±å›¾ç‰‡çš„ urlã€view çš„å®½å’Œé«˜ã€å±å¹•çš„å°ºå¯¸å¤§å°å’Œ signature ç»„æˆã€‚ åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æ‰ä¼šå‡ºç°åŠ¨æ€çš„ Url å‘¢ï¼Ÿä¸€ä¸ªå¾ˆå…¸å‹çš„ä¾‹å­å°±æ˜¯å› ä¸ºå›¾ç‰‡çš„å®‰å…¨é—®é¢˜åœ¨åŸæ¥å›¾ç‰‡çš„ Url åé¢åŠ ä¸Šè®¿é—®å‡­è¯ã€‚è®¿é—®å‡­è¯ä¸æ—¶é—´å…³è”ï¼Œè¿™æ ·ä¸€æ¥ï¼Œåœ¨ä¸åŒæ—¶é—´åŒä¸€å›¾ç‰‡çš„ Url å°±ä¼šä¸åŒï¼Œç¼“å­˜å°±ä¼šå¤±æ•ˆã€‚ä»¥ä¸ƒç‰›çš„ç§æœ‰ç©ºé—´ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å»ç¼“å­˜è¿™ç±»å›¾ç‰‡ã€‚ä»ä¸ƒç‰›å…³äºç§æœ‰ç©ºé—´çš„æ–‡æ¡£ä¸­å¯ä»¥å¾—åˆ°ï¼šæœ€ç»ˆçš„ Url = åŸ Url + ?e=è¿‡æœŸæ—¶é—´ + token=ä¸‹è½½å‡­è¯ã€‚é‚£ä¹ˆå°±åªéœ€è¦åœ¨ Glide ç¼“å­˜æ—¶å°† Url ä¸­â€œ?â€åé¢çš„å­—ç¬¦ä¸²æˆªå»å°±å¯ä»¥äº†ã€‚ é¦–å…ˆæ–°å»ºä¸€ä¸ªå«åš QiNiuImage çš„ç±»ï¼š 1234567891011121314151617181920public class QiNiuImage &#123; private final String imageUrl; public QiNiuImage(String imageUrl) &#123; this.imageUrl = imageUrl; &#125; public String getImageUrl() &#123; return imageUrl; &#125; public String getImageId() &#123; if (imageUrl.contains(&quot;?&quot;)) &#123; return imageUrl.substring(0, imageUrl.lastIndexOf(&quot;?&quot;)); &#125; else &#123; return imageUrl; &#125; &#125;&#125; å…¶ä¸­ getImageUrl æ–¹æ³•è¿”å›çœŸå®çš„ Urlï¼ŒgetImageId æ–¹æ³•è¿”å›æœªæ·»åŠ ä¸‹è½½å‡­è¯å‰çš„ Urlã€‚ç„¶åå†è‡ªå®šä¹‰ä¸€ä¸ªå®ç°ModelLoaderæ¥å£çš„ QiNiuImageLoader: 1234567891011121314151617181920212223public class QiNiuImageLoader implements StreamModelLoader&lt;QiNiuImage&gt; &#123; @Override public DataFetcher&lt;InputStream&gt; getResourceFetcher(final QiNiuImage model, int width, int height) &#123; return new HttpUrlFetcher(new GlideUrl(model.getImageUrl())) &#123; @Override public String getId() &#123; return model.getImageId(); &#125; &#125;; &#125; public static class Factory implements ModelLoaderFactory&lt;QiNiuImage, InputStream&gt; &#123; @Override public ModelLoader&lt;QiNiuImage, InputStream&gt; build(Context context, GenericLoaderFactory factories) &#123; return new QiNiuImageLoader(); &#125; @Override public void teardown() &#123; /* no op */ &#125; &#125;&#125; å…¶ä¸­ HttpUrlFetcher çš„ getId æ–¹æ³•å°±æ˜¯ç»„æˆç¼“å­˜çš„ key çš„é‡è¦éƒ¨åˆ†ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒåŸç†ã€‚å°†è¿™ä¸ª ModelLoader æ³¨å†Œåˆ° GlideModule ä¸­ï¼Œå¹¶åœ¨ AndroidManifest.xml ä¸­æ³¨å†Œ: 1234567891011public class QiNiuModule implements GlideModule &#123; @Override public void applyOptions(Context context, GlideBuilder builder) &#123; &#125; @Override public void registerComponents(Context context, Glide glide) &#123; glide.register(QiNiuImage.class, InputStream.class, new QiNiuImageLoader.Factory()); &#125;&#125; 123&lt;meta-data android:name=&quot;com.yourpackagename.QiNiuModule&quot; android:value=&quot;GlideModule&quot;/&gt; æœ€ååªéœ€è¦åœ¨åŠ è½½æ­¤ç±»å›¾ç‰‡æ—¶ï¼Œä½¿ç”¨ä¸‹é¢è¿™æ®µä»£ç å°±å¯ä»¥äº†ã€‚å³ä½¿å›¾ç‰‡çš„ token æ›´æ¢äº†ä¹Ÿä¸ä¼šé‡æ–°ä»ç½‘ç»œä¸Šä¸‹è½½è€Œæ˜¯ç›´æ¥è¯»å–æœ¬åœ°ç¼“å­˜ã€‚ 123Glide.with(context) .load(new QiNiuImage(imageUrl) .into(imageView); å‚è€ƒèµ„æ–™ï¼š https://github.com/bumptech/glide/issues/607 https://github.com/bumptech/glide/issues/501","tags":[{"name":"Cache","slug":"Cache","permalink":"http://www.imzhiqiang.com/tags/Cache/"},{"name":"Glide","slug":"Glide","permalink":"http://www.imzhiqiang.com/tags/Glide/"}]},{"title":"Androidå¤šåª’ä½“æ¡†æ¶ä¸­å‡ ä¸ªé‡è¦çš„ç±»","date":"2016-09-24T02:10:09.000Z","path":"2016/09/24/Several-important-classes-in-Android-media-framework/","text":"ä¸ iOS ä¸­å¼ºå¤§çš„ AVFoundation æ¡†æ¶ç›¸æ¯”ï¼ŒAndroid framework ä¸­æä¾›çš„æœ‰å…³å¤šåª’ä½“å¤„ç†çš„ç±»å¯è°“å±ˆæŒ‡å¯æ•°ï¼Œä½†æ€»æ¯”æ²¡æœ‰å¥½å§ã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥è°ˆè°ˆè¿™å‡ ä¸ªç±»ã€‚ è¿™é‡Œæåˆ°çš„å¤šåª’ä½“å¤„ç†ä¸»è¦æ˜¯æŒ‡éŸ³è§†é¢‘å¤„ç†ã€‚åŒ…æ‹¬éŸ³è§†é¢‘çš„è£å‰ªã€åˆå¹¶ï¼›è§†é¢‘ç”»é¢çš„å„ç§å˜æ¢ï¼Œæ—‹è½¬ã€ç¼©æ”¾ã€ç¿»è½¬ï¼›è§†é¢‘æ»¤é•œï¼›éŸ³è§†é¢‘çš„æ’­æ”¾ï¼Œå¿«é€Ÿã€æ…¢é€Ÿã€å€’åºæ’­æ”¾ç­‰ç­‰ã€‚ ä¸»è¦æ¶‰åŠåˆ°çš„ç±»æœ‰ï¼š MediaExtractorï¼šåª’ä½“æå–å™¨ MediaCodecï¼šç¼–è§£ç å™¨ MediaMuxerï¼šåª’ä½“æ··åˆå™¨ MediaMetadataRetrieverï¼š è·å–éŸ³è§†é¢‘ä¿¡æ¯çš„ç±» MediaFormat: åŒ…å«éŸ³è§†é¢‘å¸§ä¿¡æ¯çš„ç±» GLSurfaceView: å±•ç¤º openGL æ¸²æŸ“çš„ View OpenGL ç›¸å…³çš„ç±» MediaExtractor åœ¨ Android4.1ï¼ˆAPI16ï¼‰åŠ å…¥ã€‚å¯ä»¥ä»ä¸€æ®µéŸ³è§†é¢‘ä¸­æå–å‡ºä¸€å¸§ä¸€å¸§çš„æ•°æ®ï¼Œä¸ MediaMuxer é…åˆä½¿ç”¨å¯ä»¥å®Œæˆè§†é¢‘çš„è£å‰ªå’Œåˆå¹¶ï¼Œä¸ MediaCodecã€GLSurfaceView é…åˆä½¿ç”¨å¯ä»¥å®Œæˆè§†é¢‘çš„æ’­æ”¾ã€‚ MediaCodec åœ¨ Android4.1ï¼ˆAPI16ï¼‰åŠ å…¥ã€‚åœ¨ Android4.3(API18)æä¾›è¾“å…¥å¯ä»¥ä¸º Surfaceã€‚åœ¨ Android5.0ï¼ˆAPI21ï¼‰åˆå¢åŠ äº†å¼‚æ­¥å¤„ç†æ¨¡å¼ã€‚å®ƒæ˜¯ä¸€ä¸ªä½ç­‰çº§çš„åª’ä½“ç¼–è§£ç å™¨ï¼Œå¯ä»¥ä½œä¸ºç¼–ç å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè§£ç å™¨ã€‚\b å¯æ”»å¯å—ï¼Œå˜¿å˜¿å˜¿ã€‚æ˜¯éŸ³è§†é¢‘å¤„ç†ä¸­æœ€ä¸ºæ ¸å¿ƒçš„ç±»ã€‚ ç”±äºç›¸å…³æ–‡æ¡£åœ¨ä»¥å‰ä¸æ˜¯å¾ˆå®Œå–„ï¼Œæ¥è‡ª Android åª’ä½“å›¢é˜Ÿçš„ fadden(ç°å·²ä¸åœ¨)ç»´æŠ¤äº†ä¸€ä¸ªç½‘ç«™ http://bigflake.com/mediacodec/ ã€‚ä¸Šé¢æœ‰å¤§é‡çš„ç›¸å…³èµ„æºã€‚æ­¤å¤–åœ¨ stackoverflow ä¸Šé¢åªè¦æ˜¯ MeidaCodec ç›¸å…³çš„é—®é¢˜éšå¤„å¯è§ fadden çš„èº«å½±ã€‚æ„Ÿè°¢ faddenã€‚ç°åœ¨å®˜æ–¹æ–‡æ¡£å·²ç»ç›¸å½“è¯¦ç»†äº†ï¼Œä¸è¿‡éƒ½æ˜¯è‹±æ–‡çš„ï¼Œå¯¹äºé˜…è¯»å›°éš¾çš„äººï¼Œå›½å†…ä¹Ÿæœ‰äººè¿›è¡Œäº†ç¿»è¯‘ã€‚åœ°å€åœ¨[è¿™é‡Œ]ï¼ˆhttp://www.cnblogs.com/xiaoshubao/archive/2016/04/11/5368183.htmlï¼‰ ã€‚ MediaMuxer åœ¨ Android4.3(API18)ã€‚å¯ä»¥åˆæˆ MP4 æ ¼å¼çš„è§†é¢‘ï¼Œè¾“å…¥æºé€šå¸¸ä¸ºä» MediaExtractor æˆ–è€… MediaCodec æä¾›çš„å·²ç¼–ç çš„æ•°æ®ã€‚ MediaMetadataRetriever ä¸»è¦ç”¨æ¥è·å–è§†é¢‘çš„æ–¹å‘ä¿¡æ¯ã€‚åœ¨åˆæˆè§†é¢‘æ—¶ï¼Œå¯çº æ­£è§†é¢‘æ–¹å‘ã€‚æ­¤å¤–è¿˜å¯ä»¥è·å–è§†é¢‘æŸä¸€å¸§ç”»é¢çš„ bitmap,å‰æå¿…é¡»æ˜¯ android æ”¯æŒçš„è§†é¢‘æ ¼å¼ã€‚ MediaFormat å†…éƒ¨æŒæœ‰ä¸€ä¸ªåŒ…å«éŸ³è§†é¢‘å¸§ä¿¡æ¯çš„ mapã€‚ GLSurfaceView å¯ä¸ MediaPlayer é…åˆï¼Œå®Œæˆè§†é¢‘å˜æ¢çš„å„ç§æ•ˆæœå®æ—¶é¢„è§ˆã€‚ OpenGL æ˜¯ä¸€é—¨å•ç‹¬çš„æŠ€æœ¯ï¼Œç„¶è€Œå…³äºå…¶åœ¨ Android ä¸­ä½¿ç”¨çš„æ–‡æ¡£å’Œåˆ—å­å®åœ¨å¤ªå°‘ã€‚å”¯ä¸€çš„ä¸€æœ¬ä¹¦ã€ŠOpenGL ES åº”ç”¨å¼€å‘å®è·µæŒ‡å— Android å·ã€‹åœ¨ç½‘ä¸Šä¹Ÿä¹°ä¸åˆ°ï¼Œåªèƒ½å»æ·˜å®ä¹°å¤å°ç‰ˆã€‚ã€‚ã€‚","tags":[{"name":"å¤šåª’ä½“","slug":"å¤šåª’ä½“","permalink":"http://www.imzhiqiang.com/tags/%E5%A4%9A%E5%AA%92%E4%BD%93/"},{"name":"MediaCodec","slug":"MediaCodec","permalink":"http://www.imzhiqiang.com/tags/MediaCodec/"}]},{"title":"å¦‚ä½•è°ƒè¯•GlideåŠ è½½å›¾ç‰‡","date":"2015-12-01T07:23:23.000Z","path":"2015/12/01/How-to-debug-glide/","text":"å‰è¨€ä¸å…¶ä»–å›¾ç‰‡åŠ è½½åº“ä¸åŒï¼Œåœ¨ Glide åŠ è½½å›¾ç‰‡çš„è¿‡ç¨‹ä¸­é»˜è®¤æ˜¯æ²¡æœ‰ä»»ä½• log è¾“å‡ºçš„ã€‚è¿™æ ·ä½¿å¾—åŠ è½½å¤±è´¥çš„åŸå› éš¾ä»¥è°ƒè¯•ã€‚åˆ°åº•æ˜¯ç½‘ç»œé”™è¯¯è¿˜æ˜¯å›¾ç‰‡æ ¹æœ¬å°±ä¸å­˜åœ¨äº¦æˆ–è€…è§£ç å‡ºé”™ï¼Œæˆ‘ä»¬ä¸å¾—è€ŒçŸ¥ã€‚å½“ç„¶å®˜æ–¹ä¹Ÿç»™å‡ºäº†è°ƒè¯•çš„æ–¹æ³•ï¼Œè¿™ç¯‡æ–‡ç« å°±æ¥ä»‹ç»ä¸‹å¦‚ä½•è°ƒè¯• Glide åŠ è½½å›¾ç‰‡ï¼Œå†…å®¹ä¸»è¦æ˜¯å¯¹å®˜æ–¹ wiki çš„ç¿»è¯‘ã€‚ æ­£æ–‡åœ¨ Glide åŠ è½½å›¾ç‰‡è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸æ—¶ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ log è¾“å‡ºçš„ã€‚ä½†æ˜¯ Glide ç»™å¼€å‘è€…æä¾›äº†ä¸¤ç§æ–¹æ³•æ¥æŸ¥çœ‹æˆ–è€…å“åº”è¿™äº›å¼‚å¸¸ã€‚ è°ƒè¯•ä¸ºäº†åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶å¯ä»¥çœ‹åˆ°å®ƒä»¬ï¼Œä½ å¯ä»¥æ‰“å¼€ Glide ä¸­å¤„ç†æ‰€æœ‰åª’ä½“åŠ è½½å“åº”çš„ç±» GenericRequest çš„ log å¼€å…³ã€‚å¾ˆç®€å•ï¼Œåœ¨å‘½ä»¤è¡Œè¿è¡Œä¸‹é¢çš„æŒ‡ä»¤å³å¯ï¼š 1adb shell setprop log.tag.GenericRequest DEBUG å¦‚æœä½ å°† DEBUG æ›¿æ¢ä¸º VERBOSEï¼Œè¿˜å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„è¯·æ±‚æ—¶é—´æ—¥å¿—ã€‚ å¦‚æœä½ æƒ³ç¦ç”¨ log è¾“å‡ºï¼Œæ‰§è¡Œï¼š 1adb shell setprop log.tag.GenericRequest ERROR è°ƒè¯•å·¥ä½œæµ ä¸ºäº†æŸ¥çœ‹ Glide å†…éƒ¨å¼•æ“æ˜¯ä½•æ—¶ã€å¦‚ä½•åŠ è½½å›¾ç‰‡çš„ï¼Œä½ å¯ä»¥å¯ç”¨è¿™äº› log: 123adb shell setprop log.tag.Engine VERBOSEadb shell setprop log.tag.EngineJob VERBOSEadb shell setprop log.tag.DecodeJob VERBOSE å¯ç”¨è¿™äº› log å¯ä»¥å¸®åŠ©ä½ äº†è§£åˆ°ä¸ºä»€ä¹ˆæŸäº›èµ„æºæ²¡æœ‰ä»å†…å­˜ä¸­åŠ è½½ï¼Ÿä¸ºä»€ä¹ˆä»å¤–éƒ¨ url åŠ è½½è¦é‡æ–°ä¸‹è½½æ•°æ®ï¼ŸåŒæ—¶è¿™ä¹Ÿæœ‰åŠ©äºäº†è§£åœ¨ç£ç›˜ç¼“å­˜æ—¶å“ªäº›å‚æ•°éœ€è¦é…ç½®ã€‚å¯ç”¨ DecodeJob log è¿˜å¯ä»¥å¸®åŠ©ä½ äº†è§£è‡ªå®šä¹‰å˜æ¢/è§£ç å™¨/ç¼–ç å™¨ç­‰ç›¸å…³é—®é¢˜ã€‚ è¯·æ±‚ç›‘å¬å™¨è™½ç„¶å¯åŠ¨è°ƒè¯•æ—¥å¿—å¾ˆç®€å•ï¼Œä½†å‰ææ˜¯ä½ å¯ä»¥è®¿é—®åˆ°è®¾å¤‡ã€‚ä¸ºäº†å®Œå–„ Glide å·²å­˜åœ¨æˆ–æ›´å¤æ‚çš„é”™è¯¯æ—¥å¿—ç³»ç»Ÿï¼Œä½ å¯ä»¥ä½¿ç”¨ RequestListener ç±»ã€‚å½“åŠ è½½è¯·æ±‚å¤±è´¥æ—¶ onException()æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ç»™å‡ºé€ æˆå¤±è´¥çš„å¼‚å¸¸æˆ–è€… null(åœ¨è§£ç å™¨æ— æ³•ä»å®ƒè·å–åˆ°çš„æ•°æ®ä¸­è§£ç å‡ºä»»ä½•æœ‰ç”¨çš„ä¸œè¥¿æ—¶)ã€‚ä½ å¯ä»¥é€šè¿‡ listener() API ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨ã€‚ ç¡®ä¿ onException()æ–¹æ³•çš„è¿”å›å€¼ä¸º falseï¼Œé¿å…è¦†ç›– Glide é»˜è®¤çš„é”™è¯¯å¤„ç†ï¼ˆæ¯”å¦‚åŠ è½½å¤±è´¥çš„é”™è¯¯å›¾ç‰‡å ä½ï¼‰ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªå®ç°å¿«é€Ÿè°ƒè¯•çš„åˆ—å­: 12345678910111213// ç¤ºä¾‹: .listener(new LoggingListener&lt;String, GlideDrawable&gt;())public class LoggingListener&lt;T, R&gt; implements RequestListener&lt;T, R&gt; &#123; @Override public boolean onException(Exception e, Object model, Target target, boolean isFirstResource) &#123; android.util.Log.d(&quot;GLIDE&quot;, String.format(Locale.ROOT, &quot;onException(%s, %s, %s, %s)&quot;, e, model, target, isFirstResource), e); return false; &#125; @Override public boolean onResourceReady(Object resource, Object model, Target target, boolean isFromMemoryCache, boolean isFirstResource) &#123; android.util.Log.d(&quot;GLIDE&quot;, String.format(Locale.ROOT, &quot;onResourceReady(%s, %s, %s, %s, %s)&quot;, resource, model, target, isFromMemoryCache, isFirstResource)); return false; &#125;&#125; ç¡®ä¿åœ¨å‘å¸ƒåº”ç”¨æ—¶ç§»é™¤æ‰æ‰€æœ‰çš„è°ƒè¯• log! æ›´å¤šçš„ log æŒ‡ä»¤è¿™ä¸ªåˆ—è¡¨æ˜¯åŸºäº Glide 3.6.0 ç‰ˆæœ¬çš„ï¼Œå¹¶ä¸å®Œæ•´ã€‚ 12345678910111213141516171819202122232425262728293031cd ...&#x2F;android-sdk&#x2F;platform-toolsadb shell setprop log.tag.AnimatedGifEncoder VERBOSEadb shell setprop log.tag.AssetUriFetcher VERBOSEadb shell setprop log.tag.BitmapEncoder VERBOSEadb shell setprop log.tag.BufferedIs VERBOSEadb shell setprop log.tag.ByteArrayPool VERBOSEadb shell setprop log.tag.CacheLoader VERBOSEadb shell setprop log.tag.ContentLengthStream VERBOSEadb shell setprop log.tag.DecodeJob VERBOSEadb shell setprop log.tag.DiskLruCacheWrapper VERBOSEadb shell setprop log.tag.Downsampler VERBOSEadb shell setprop log.tag.Engine VERBOSEadb shell setprop log.tag.EngineRunnable VERBOSEadb shell setprop log.tag.GenericRequest VERBOSEadb shell setprop log.tag.GifDecoder VERBOSEadb shell setprop log.tag.GifEncoder VERBOSEadb shell setprop log.tag.GifHeaderParser VERBOSEadb shell setprop log.tag.GifResourceDecoder VERBOSEadb shell setprop log.tag.Glide VERBOSEadb shell setprop log.tag.ImageHeaderParser VERBOSEadb shell setprop log.tag.ImageVideoDecoder VERBOSEadb shell setprop log.tag.IVML VERBOSEadb shell setprop log.tag.LocalUriFetcher VERBOSEadb shell setprop log.tag.LruBitmapPool VERBOSEadb shell setprop log.tag.MediaStoreThumbFetcher VERBOSEadb shell setprop log.tag.MemorySizeCalculator VERBOSEadb shell setprop log.tag.PreFillRunner VERBOSEadb shell setprop log.tag.ResourceLoader VERBOSEadb shell setprop log.tag.RMRetriever VERBOSEadb shell setprop log.tag.StreamEncoder VERBOSEadb shell setprop log.tag.TransformationUtils VERBOSE","tags":[{"name":"Glide","slug":"Glide","permalink":"http://www.imzhiqiang.com/tags/Glide/"},{"name":"è°ƒè¯•","slug":"è°ƒè¯•","permalink":"http://www.imzhiqiang.com/tags/%E8%B0%83%E8%AF%95/"}]},{"title":"è®°å½•ä¸€æ¬¡v4åŒ…ä¸­SwipeRefreshLayoutçš„â€œå‘çˆ¹â€äº‹ä»¶","date":"2015-11-19T05:29:16.000Z","path":"2015/11/19/An-accident-about-SwipeRefreshLayout-in-support-v4-package/","text":"å½“ android support v4 åŒ…å’Œ v7 åŒ…ç‰ˆæœ¬ä¸ä¸€æ ·æ—¶ï¼Œv4 åŒ…ä¸­çš„ SwipeRefreshLayout å’Œ v7 åŒ…ä¸­çš„ RecyclerView ä¸èƒ½å¾ˆå¥½åœ°ä¸€èµ·å·¥ä½œï¼Œä¼šå¯¼è‡´ SwipeRefreshLayout ä¸‹æ‹‰åˆ·æ–°æ—¶åŠ¨ç”»å¡ä½çš„æƒ…å†µï¼Œç±»ä¼¼ä¸‹é¢çš„æƒ…å†µï¼š è¯¦æƒ…è¯·å‚è€ƒ: http://stackoverflow.com/questions/33032036/swiperefreshlayout-freezes-on-api-4-2-2ã€‚ å¦‚æœä½ çš„é¡¹ç›®ä¸­ç”¨åˆ°äº†photoviewï¼Œå¹¶ä¸” targetSdk è¿˜æ˜¯ 22 çš„è¯ï¼Œè¯·ä¸è¦ä½¿ç”¨é»˜è®¤çš„ Gradle å¼•ç”¨ï¼š 1compile &#39;com.commit451:PhotoView:1.2.4&#39; å› ä¸ºè¿™ä¸ªç‰ˆæœ¬çš„ photoview é»˜è®¤ä¾èµ–äº† support v4 23.0.1 ç‰ˆæœ¬ï¼Œä½¿å¾— 23.0.1 ç‰ˆæœ¬ä¸­çš„ SwipeRefreshLayout å’Œ 22 ç‰ˆæœ¬ä¸­çš„ RecyclerView ä¸èƒ½å¾ˆå¥½åœ°åè°ƒå·¥ä½œã€‚ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å¼•ç”¨æ¥å¼•å…¥ photoview: 1compile &#39;com.github.chrisbanes.photoview:library:1.2.4&#39; å¦‚æœä¸æ˜¯ç‰¹æ„å»æŸ¥çœ‹ï¼Œä½ è¿˜å¾ˆéš¾å‘ç°è¿™ä¸ªç»†èŠ‚ï¼Œå› ä¸º targetSdk ä¸º 22 çš„æƒ…å†µä¸‹æ˜¯ä¸ä¼šå¼•ç”¨ 23.0.1 ç‰ˆæœ¬çš„ v4 åŒ…çš„ï¼Œé™¤éä½ é¡¹ç›®ä¸­æœ‰å…¶ä»–çš„ library å¼•ç”¨äº†ã€‚ å°ç»“åœ¨å¼•å…¥å®˜æ–¹ support åº“æ—¶ï¼ŒåŠ¡å¿…ä¿è¯ç‰ˆæœ¬ä¸€è‡´ï¼›åœ¨å¼•å…¥ç¬¬ä¸‰æ–¹åº“æ—¶ï¼ŒåŠ¡å¿…æŸ¥çœ‹ç¬¬ä¸‰æ–¹åº“çš„ä¾èµ–åº“ï¼Œå…å‘ã€‚","tags":[{"name":"å‘","slug":"å‘","permalink":"http://www.imzhiqiang.com/tags/%E5%9D%91/"},{"name":"SwipeRefreshLayout","slug":"SwipeRefreshLayout","permalink":"http://www.imzhiqiang.com/tags/SwipeRefreshLayout/"}]},{"title":"ä½¿ç”¨GlideåŠ è½½å›¾ç‰‡ç³»åˆ—ä¹‹ä¸€ä»ä¸åŒçš„æ•°æ®æºåŠ è½½å›¾ç‰‡","date":"2015-10-27T14:12:47.000Z","path":"2015/10/27/Load-images-from-difference-data-sources/","text":"ä¸å…¶ä»–å›¾ç‰‡åŠ è½½åº“ç›¸åŒï¼ŒGlide é™¤äº†å¯ä»¥åŠ è½½ç½‘ç»œå›¾ç‰‡ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥åŠ è½½æœ¬åœ°å›¾ç‰‡ã€‚ç”šè‡³è¿˜å¯ä»¥ä»å„ç§å„æ ·å¥‡è‘©çš„æ•°æ®æºä¸­åŠ è½½å›¾ç‰‡ã€‚ åŠ è½½ç½‘ç»œå›¾ç‰‡å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨å›¾ç‰‡åŠ è½½åº“å°±æ˜¯ä¸ºäº†åŠ è½½ç½‘ç»œå›¾ç‰‡ã€‚ç½‘ç»œæ“ä½œæ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„ä¸œè¥¿ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰å›¾ç‰‡åŠ è½½åº“ï¼Œæˆ‘ä»¬å°±è¦æ‰‹åŠ¨å»ä¸‹è½½å›¾ç‰‡,ç¼“å­˜å›¾ç‰‡ï¼Œæœ€åå†ä»æ–‡ä»¶é‡Œé¢è¯»å– bitmap å¹¶è®¾ç½®åˆ° Imageview é‡Œé¢ã€‚è¿™è¿˜ç®—å¥½çš„ï¼Œè¦æ˜¯åœ¨ Listview é‡Œé¢ä½ ä¼šæ›´å¤´ç–¼çš„ã€‚åŸå› æˆ‘å°±ä¸è¯´äº†ï¼Œä½ æ‡‚çš„~~å†åŠ ä¸Šå„ç§å„æ ·çš„ Bitmap æ“ä½œï¼Œä¿å‡†ä½ å†ä¹Ÿä¸æƒ³æ’¸ä»£ç äº†ã€‚è€Œä¸” Bitmap è¿™ä¸œè¥¿è¿˜å¾ˆå å†…å­˜ï¼Œä¼ºå€™ä¸å¥½ï¼Œå¾ˆå®¹æ˜“å°±ä¼šå¼•å‘ OOMï¼Œapp å§å”§å°±é—ªé€€äº†ï¼ï¼ å›¾ç‰‡åŠ è½½åº“çš„ä¼˜åŠ¿å°±åœ¨äºæ­¤ã€‚ç®€ç®€å•å•ä¸€å¥è¯ï¼Œä¸‹è½½ï¼Œç¼“å­˜ï¼ŒåŠ è½½ç»Ÿç»Ÿæå®šã€‚ç®€ç›´å°±æ˜¯ç¾å¥½ä¸€ç”Ÿçš„ä¸œè¥¿ã€‚è€Œ Glide å°±æ˜¯è¿™æ ·ä½¿äººç¾å¥½ä¸€ç”Ÿçš„ä¸œè¥¿ä¹‹ä¸€ã€‚ è¯´äº†è¿™ä¹ˆå¤šï¼ŒGlide å¦‚ä½•åŠ è½½ç½‘ç»œå›¾ç‰‡ï¼Ÿå¾ˆç®€å•ï¼Œå°±ä¸Šæ¬¡çš„ä¸‰å¥è¯: 123456ImageView targetImageView = (ImageView) findViewById(R.id.imageView);String internetUrl = &quot;http://i.imgur.com/idojSYm.png&quot;;Glide .with(context) .load(internetUrl) .into(targetImageView); æœ¨æœ‰ä»€ä¹ˆä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿ï¼Œç›´æ¥ä¼ å…¥è¦åŠ è½½å›¾ç‰‡çš„ url å°±å¯ä»¥äº†ã€‚é‚£ä¹ˆå›¾ç‰‡åŠ è½½åº“æœ‰å¾ˆå¤šï¼Œä¸ºä»€ä¹ˆé€‰æ‹© Glide å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå› ä¸ºå®ƒæµç•…ï¼Œä¸å¡ï¼Œå°¤å…¶æ˜¯åœ¨ Listview ä¸­ã€‚å—¯ï¼Œå°±æ˜¯é…±~ åŠ è½½æœ¬åœ°å›¾ç‰‡ä¸‹è¡¨æ˜¯.load()å¯ä»¥ä¼ å…¥çš„å‚æ•°åŠè¯´æ˜ å‚æ•° è¯´æ˜ .load(String string) string å¯ä»¥ä¸ºä¸€ä¸ªæ–‡ä»¶è·¯å¾„ã€uri æˆ–è€… url .load(Uri uri) uri ç±»å‹ .load(File file) æ–‡ä»¶ .load(Integer resourceId) èµ„æº Id,R.drawable.xxx æˆ–è€… R.mipmap.xxx .load(byte[] model) byte[]ç±»å‹ .load(T model) è‡ªå®šä¹‰ç±»å‹ ä»ä¸Šé¢å¯ä»¥çœ‹åˆ° Glide ä¸ä»…å¯ä»¥åŠ è½½ç½‘ç»œå›¾ç‰‡ï¼Œè¿˜å¯ä»¥åŠ è½½æœ¬åœ°å›¾ç‰‡ã€‚å¯æ¥å—çš„å‚æ•°æœ‰æ–‡ä»¶è·¯å¾„ï¼Œuriï¼Œæ–‡ä»¶ï¼Œèµ„æº id ç­‰ã€‚åŸºæœ¬ä¸Šæ»¡è¶³äº†å¤§éƒ¨åˆ†çš„éœ€æ±‚ã€‚è™½ç„¶åŠ è½½æœ¬åœ°å›¾ç‰‡ä¸åƒç½‘ç»œå›¾ç‰‡é‚£æ ·å¤æ‚ï¼Œä½†æˆ‘è¿˜æ˜¯å»ºè®®ä½¿ç”¨ Glide æ¥åŠ è½½æœ¬åœ°å›¾ç‰‡ã€‚å› ä¸ºå®ƒæ˜¯å†…å­˜å‹å¥½çš„ï¼Œè€Œä¸”è¿˜ä¼šâ€œå·å·åœ°â€å¸®æˆ‘ä»¬åšå¾ˆå¤šäº‹æƒ…ã€‚æ¯”å¦‚å†…å­˜ç¼“å­˜ï¼ŒBitmap å¤ç”¨ï¼Œä¿®æ­£ç…§ç‰‡æ–¹å‘ç­‰ã€‚å½“ç„¶ä¸ºäº†æ»¡è¶³å„ç§å„æ ·çš„éœ€æ±‚ï¼Œä»…ä»…åŠ è½½å›¾ç‰‡æ˜¯ä¸å¤Ÿçš„ï¼Œä½ è¿˜éœ€è¦å¯¹å›¾ç‰‡è¿›è¡Œå„ç§å„æ ·çš„å˜æ¢ï¼Œä¹Ÿå°±æ˜¯ Transformationã€‚åé¢æˆ‘ä»¬ä¼šè¯¦ç»†äº†è§£çš„ã€‚ åŠ è½½è‡ªå®šä¹‰æ•°æ®æºå‰é¢çš„è¡¨æ ¼ä¸­æœ‰ä¸€ä¸ªæ˜¯æˆ‘ä»¬ä¸ç†Ÿæ‚‰çš„ï¼Œå°±æ˜¯.load(T model)ï¼Œå³è‡ªå®šä¹‰çš„æ•°æ®æºç±»å‹ã€‚é‚£ä¹ˆå¦‚ä½•å»å®ç°å‘¢ï¼Ÿ å®é™…ä¸Šï¼ŒåŠ è½½è‡ªå®šä¹‰æ•°æ®æºä¸»è¦æ˜¯é€šè¿‡ ModelLoader æ¥å£æ¥å®ç°çš„ã€‚ç”±äºæ²¡æœ‰åœ¨å®é™…é¡¹ç›®ä¸­ç”¨åˆ°è¿‡ï¼Œè¿™æ–¹é¢çš„ç»éªŒæ¯”è¾ƒå°‘ã€‚æƒ³æ·±å…¥äº†è§£çš„ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ ä¸è¿‡ä»å®˜æ–¹ Wiki ä¸Šæ¥çœ‹ï¼Œè®¾è®¡ ModelLoader æ¥å£çš„åˆè¡·ç”¨æ¥åŠ è½½ä¸åŒå°ºå¯¸çš„å›¾ç‰‡çš„ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒAndroid è®¾å¤‡å±å¹•åˆ†è¾¨ç‡åƒå¥‡ç™¾æ€ªï¼Œå¤§åˆ° 2Kï¼Œå°åˆ° 320pã€‚å¦‚æœåœ¨ä½åˆ†è¾¨ç‡çš„æ‰‹æœºä¸ŠåŠ è½½å¤§å›¾ï¼Œä¸ä»…æŸè€—ç”¨æˆ·æµé‡ï¼Œè€Œä¸”å¾ˆå®¹æ˜“é€ æˆ OOMï¼›åœ¨é«˜åˆ†è¾¨çš„æ‰‹æœºä¸Šï¼ŒåŠ è½½å°å›¾åˆä¼šå‡ºç°æ¨¡ç³Šçš„æƒ…å†µï¼Œç”¨æˆ·ä½“éªŒæå·®ã€‚å¾ˆå¤šæ—¶å€™ï¼Œä¸ºäº†çœäº‹ï¼Œå¾ˆå¤š app éƒ½ä¼šé€‰æ‹©ä¸€ä¸ªä¸­é—´åˆ†è¾¨ç‡ï¼Œç„¶åè‡ªé€‚åº”å¤§å°ã€‚å½“ç„¶è¿™æ ·åšæ— å¯åšéï¼Œä½†æ˜¯æœ‰æ›´å¥½çš„åŠæ³•ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸å»å°è¯•å‘¢ï¼Ÿ é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨ Glide æ¥å®ç°è¿™ä¸€å…·ä½“éœ€æ±‚å‘¢ï¼Ÿé¦–å…ˆä½ è¦å®ç°è‡ªå·±çš„ ModelLoaderï¼Œæ¯”è¾ƒç®€å•çš„æ–¹æ³•æ˜¯ç»§æ‰¿BaseGlideUrlLoaderã€‚ 12345678910public interface MyDataModel &#123; public String buildUrl(int width, int height);&#125;public class MyUrlLoader extends BaseGlideUrlLoader&lt;MyDataModel&gt; &#123; @Override protected String getUrl(MyDataModel model, int width, int height) &#123; // Construct the url for the correct size here. return model.buildUrl(width, height); &#125;&#125; æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥åŠ è½½å›¾ç‰‡ï¼š 12345678910111213Glide.with(this) .using(new MyUrlLoader(this)) .load(new MyDataModel() &#123; @Override public String buidUrl(int width, int height) &#123; if (width &gt;= 600) &#123; return url1; &#125; else &#123; return url2; &#125; &#125; &#125;) .into(imageView); .using(new MyUrlLoader(this))ï¼šä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„ ModeLoader;.load(new MyDataModel()):åŠ è½½æˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®æº è¿™é‡Œéœ€è¦è§£é‡Šä¸‹ getUrl çš„ä¸‰ä¸ªå‚æ•°ï¼šmodelï¼šä½ åŠ è½½çš„æ•°æ®æºwidthï¼šä½ åŠ è½½çš„å›¾ç‰‡çš„å®½åº¦(px)heightï¼šä½ åŠ è½½çš„å›¾ç‰‡çš„é«˜åº¦(px) è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨é«˜åˆ†ç‡çš„è®¾å¤‡ä¸ŠåŠ è½½å¤§å›¾çš„ url1ï¼Œåœ¨ä½åˆ†è¾¨ç‡çš„è®¾å¤‡ä¸ŠåŠ è½½å°å›¾ url2ã€‚ä»è€Œå®ç°äº†æ ¹æ®ä¸åŒæ‰‹æœºä¸Šçš„åƒç´ å€¼å¤§å°åŠ è½½ä¸åŒå°ºå¯¸çš„å›¾ç‰‡çš„éœ€æ±‚ã€‚ å½“ç„¶å¦‚æœä½ ä¸æƒ³æ¯æ¬¡éƒ½æ˜¯ç”¨.using(new MyUrlLoader())ï¼Œå°±éœ€è¦å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ModelLoaderFactoryå¹¶åœ¨ GlideModule ä¸­æ³¨å†Œã€‚ 12345678public class MyGlideModule implements GlideModule &#123; ... @Override public void registerComponents(Context context, Glide glide) &#123; glide.register(MyDataModel.class, InputStream.class, new MyUrlLoader.Factory()); &#125;&#125; åŒæ—¶ä¹Ÿè¦åœ¨ AndroidManifest.xml å£°æ˜ 123&lt;meta-data android:name=&quot;com.mypackage.MyGlideModule&quot; android:value=&quot;GlideModule&quot; /&gt; å¦‚æœä½ æœ‰å¤šä¸ªè‡ªå®šä¹‰çš„ GlideModule ç±»ï¼Œé‚£ä¹ˆä¹Ÿè¦åœ¨ AndroidManifest.xml ä¸­å£°æ˜å¤šä¸ª GlideModuleã€‚ å¯¹äºä¸Šé¢çš„åŠ è½½ä¸åŒå°ºå¯¸çš„å›¾ç‰‡ï¼ŒGoogle çš„ 2014 å¹´ I/O å¤§ä¼š App ä¸­æœ‰ä¸€ç¯‡æ–‡ç« ä¸“é—¨ç”¨æ¥ä»‹ç»è¿™ä¸ªçš„ï¼Œåœ°å€åœ¨è¿™é‡Œã€‚å¤§æ¦‚åŸç†æ˜¯è¿™æ ·å­çš„ï¼š åœ¨æœåŠ¡ç«¯æœ‰ä¸‹é¢çš„å‡ ä¸ªå¯ä»¥åŠ è½½çš„ urlï¼š URL å›¾ç‰‡å¤§å° myserver.com/images/__w-200-400-600-800-1000__/session1.jpg åŸå§‹å°ºå¯¸ myserver.com/images/w200/session1.jpg 200px myserver.com/images/w400/session1.jpg 400px myserver.com/images/w600/session1.jpg 600px myserver.com/images/w800/session1.jpg 800px myserver.com/images/w1000/session1.jpg 1000px é‚£ä¹ˆå®¢æˆ·ç«¯å¦‚ä½•æ ¹æ®ä¸åŒçš„æ‰‹æœºåˆ†è¾¨ç‡å»åŠ è½½ä¸åŒçš„ url å‘¢ï¼Ÿ Google æ˜¯è¿™æ ·åšçš„ï¼Œä¸‹é¢æ˜¯æ ¸å¿ƒä»£ç ï¼š 123456789101112131415161718192021222324//å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼private static final Pattern PATTERN = Pattern.compile(&quot;__w-((?:-?\\\\d+)+)__&quot;);@Overrideprotected String getUrl(String model, int width, int height) &#123; Matcher m = PATTERN.matcher(model); int bestBucket = 0; if (m.find()) &#123; String[] found = m.group(1).split(&quot;-&quot;);//æ‹¿åˆ°å¯ä»¥åŠ è½½çš„å°ºå¯¸æ•°ç»„ for (String bucketStr : found) &#123; bestBucket = Integer.parseInt(bucketStr); if (bestBucket &gt;= width) &#123;//åˆšå¥½å¤§äºè¦åŠ è½½çš„å°ºå¯¸ï¼Œç›´æ¥è·³å‡ºå¾ªç¯ // the best bucket is the first immediately // bigger than the requested width break; &#125; &#125; if (bestBucket &gt; 0) &#123;//è¿”å›åˆé€‚å°ºå¯¸çš„url model = m.replaceFirst(&quot;w&quot;+bestBucket); &#125; &#125; return model;&#125; å¤§æ¦‚çš„æ­¥éª¤å¦‚ä¸‹ï¼š 1.æ ¹æ®æœåŠ¡ç«¯å¯åŠ è½½çš„å›¾ç‰‡ url å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼ 2.æ ¹æ®æ­£åˆ™åŒ¹é…ï¼Œè·å–åˆ°å¯ä»¥åŠ è½½çš„å›¾ç‰‡å°ºå¯¸æ•°ç»„ 3.æ ¹æ®è¦åŠ è½½çš„ Imageview çš„å¤§å°ï¼Œé€‰æ‹©åˆé€‚çš„å°ºå¯¸çš„ url 4.æ‹¼æ¥ url å¹¶è¿”å› ä¸Šé¢çš„ä¾‹å­ä¸­æœ‰ 200,400,600,800,1000 æ˜¯å¯ä»¥åŠ è½½çš„ï¼Œå¦‚æœä½ è¦åŠ è½½çš„ Imageview çš„å¤§å°ä¸º 600px,å½“éå†æ•°ç»„åˆ° 600 æ—¶ï¼Œå°±ä¼šç›´æ¥è·³å‡ºå¾ªç¯ï¼Œè¿”å› 600px å¤§å°å›¾ç‰‡çš„ urlï¼ŒGlide å°±ä¼šåŠ è½½ 600px çš„å›¾ç‰‡ã€‚ æœ€åé€ä¸Šä¸€ä¸ªå° demo:https://github.com/Alluretears/GldieDemo","tags":[{"name":"Glide","slug":"Glide","permalink":"http://www.imzhiqiang.com/tags/Glide/"},{"name":"æ•°æ®æº","slug":"æ•°æ®æº","permalink":"http://www.imzhiqiang.com/tags/%E6%95%B0%E6%8D%AE%E6%BA%90/"}]},{"title":"ä½¿ç”¨GlideåŠ è½½å›¾ç‰‡ç³»åˆ—ä¹‹é›¶åˆè¯†Glide","date":"2015-10-27T14:04:06.000Z","path":"2015/10/27/Hello-Glide/","text":"åºŸè¯ä¸å¤šè¯´ï¼Œå¼€æ’¸ï¼ˆJunk Words No More Say,Letâ€™s LOLï¼‰ å’‹æ·»åŠ  Glide ä¾èµ–å‘€ï¼Ÿä¸€å¥è¯ï¼ˆOne Wordï¼‰ï¼š 1compile &#39;com.github.bumptech.glide:glide:3.6.1&#39; ä¸å¤šè¯´(No More Say)ã€‚ PhotoShop:å¦‚æœä½ è¿˜åœ¨ç”¨ä¸€é¢—åˆ©æ™®æ–¯(eclipse)ï¼Œè¯·å‰å¾€ Glide åœ¨ github ä¸Šçš„å‘å¸ƒé¡µï¼Œä¸‹è½½æœ€æ–°çš„ jar åŒ…å§ï¼Œåœ°å€æ˜¯ shaï¼Ÿè‡ªå·±æ‰¾ â†’_â†’ æœ€ç®€å•çš„åŠ è½½æ–¹å¼123456ImageView targetImageView = (ImageView) findViewById(R.id.imageView);String internetUrl = &quot;http://i.imgur.com/idojSYm.png&quot;;Glide .with(context) .load(internetUrl) .into(targetImageView); è¿™éƒ½å˜›æ„æ€å•Šï¼Ÿè«æ…Œï¼Œæˆ‘æ¥è£…ä¸‹ B: .with(Context context),æ­¤å¤„çš„ context å°±æ˜¯ä½ ç†Ÿæ‚‰çš„ contextï¼Œæ²¡å•¥ä¸ä¸€æ ·çš„ã€‚å°±æ˜¯æœ‰ä¸€ç‚¹ï¼Œé‡Œé¢å¯ä»¥æ˜¯ fragmentã€‚ .load(String imageUrl),ä½ è¦åŠ è½½çš„å›¾ç‰‡åœ°å€ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ uri æˆ–è€… file,äº¦æˆ–æ˜¯ R.drawable.xxxxã€‚ .into(ImageView targetImageView)ï¼Œä½ è¦åŠ è½½çš„ Imageview æ§ä»¶ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸€ä¸ª view,ä¸è¿‡é‚£éƒ½æ˜¯åè¯ã€‚","tags":[{"name":"Glide","slug":"Glide","permalink":"http://www.imzhiqiang.com/tags/Glide/"},{"name":"å›¾ç‰‡åŠ è½½åº“","slug":"å›¾ç‰‡åŠ è½½åº“","permalink":"http://www.imzhiqiang.com/tags/%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E5%BA%93/"}]},{"title":"Glide ï¼šä¸€ä¸ªä¸“æ³¨äºå¹³æ»‘æ»šåŠ¨çš„å›¾ç‰‡åŠ è½½å’Œç¼“å­˜åº“","date":"2015-08-23T08:19:12.000Z","path":"2015/08/23/Some-tips-with-Glide/","text":"åœ¨å›¾ç‰‡åŠ è½½åº“çƒ‚å¤§è¡—çš„ä»Šå¤©ï¼Œé€‰æ‹©ä¸€ä¸ªé€‚åˆè‡ªå·±ä½¿ç”¨çš„å›¾ç‰‡åŠ è½½åº“å·²ç»æˆä¸ºäº†æ¯ä¸€ä¸ª Android å¼€å‘è€…çš„å¿…ç»ä¹‹è·¯ã€‚ç°åœ¨å¸‚é¢ä¸ŠçŸ¥åçš„å›¾ç‰‡åŠ è½½åº“æœ‰UIL,Picasso,Volley ImageLoader,Frescoä»¥åŠæˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’Glideã€‚å®ƒä»¬å„æœ‰åƒç§‹ï¼Œä¸èƒ½è¯„å®šè°ä¸€å®šæ¯”è°å¥½ï¼Œåªèƒ½è¯´å“ªä¸€ä¸ªæ›´é€‚åˆä½ ã€‚ æˆ‘çš„ç†è§£ä¸‹é¢æˆ‘æ¥è°ˆä¸€ä¸‹ä¸ªäººå¯¹è¿™äº›å›¾ç‰‡åŠ è½½åº“çš„ç†è§£ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¿˜æœ›æŒ‡æ•™ã€‚ Universal Image Loaderï¼šä¸€ä¸ªå¼ºå¤§çš„å›¾ç‰‡åŠ è½½åº“ï¼ŒåŒ…å«å„ç§å„æ ·çš„é…ç½®ï¼Œæœ€è€ç‰Œï¼Œä½¿ç”¨ä¹Ÿæœ€å¹¿æ³›ã€‚ Picasso: Square å‡ºå“ï¼Œå¿…å±ç²¾å“ã€‚å’Œ OkHttp æ­é…èµ·æ¥æ›´é…å‘¦ï¼ Volley ImageLoaderï¼šGoogle å®˜æ–¹å‡ºå“ï¼Œå¯æƒœä¸èƒ½åŠ è½½æœ¬åœ°å›¾ç‰‡~ Frescoï¼šFacebook å‡ºçš„ï¼Œå¤©ç”Ÿéª„å‚²ï¼ä¸æ˜¯ä¸€èˆ¬çš„å¼ºå¤§ã€‚ Glideï¼šGoogle æ¨èçš„å›¾ç‰‡åŠ è½½åº“ï¼Œä¸“æ³¨äºæµç•…çš„æ»šåŠ¨ã€‚ æ›´å¤šè¯¦æƒ…è¯·çœ‹ stackoverflow ä¸Šè¿™ä¸ªé—®é¢˜ã€‚ åˆè¯• Glideä¸‹é¢è¿›å…¥ä»Šå¤©çš„ä¸»é¢˜ï¼Œç›¸ä¿¡ä¹‹å‰å¾ˆå¤šåŒå­¦éƒ½çœ‹åˆ°è¿‡è¿™ç¯‡ä»‹ç» Glide çš„æ–‡ç« ,ä¸­æ–‡ç‰ˆåœ¨è¿™é‡Œã€‚æ–‡ä¸­ä»å„ä¸ªæ–¹é¢ä»‹ç»å’Œæ¯”è¾ƒäº† Glide ä¸ Picassoï¼Œæ€»ä½“æ¥è¯´äºŒè€…æä¸ºç›¸ä¼¼ï¼Œæœ‰ç€è¿‘ä¹ç›¸åŒçš„ API çš„ä½¿ç”¨é£æ ¼ã€‚ä½† Glide åœ¨ç¼“å­˜ç­–ç•¥å’ŒåŠ è½½ GIF æ–¹é¢ç•¥èƒœä¸€ç­¹ã€‚æœ€åä½œè€…ä¹ŸæåŠ›æ¨èäº†è¿™ä¸ªåº“ã€‚ è€Œä¸”æ®è¯´åœ¨ Google æ–°å‡ºçš„ Photos åº”ç”¨ä¸­ï¼Œåˆ°å¤„å¯è§ Glide çš„è¸ªè¿¹ã€‚çœ‹åˆ°è¿™é‡Œï¼Œä½ æ˜¯ä¸æ˜¯å·²ç»è¿«ä¸åŠå¾…çš„æƒ³è¯•ä¸€è¯•è¿™ä¸ªåº“å‘¢ï¼Ÿå°±åœ¨ä½ ä¸‹å®šå†³å¿ƒå°è¯•ä¸€è®°çš„æ—¶å€™ï¼Œä½ åˆå¬è¯´ Yelp app(æ®è¯´æ˜¯ç¾å›½çš„å¤§ä¼—ç‚¹è¯„)ä¹Ÿåœ¨ä½¿ç”¨è¿™ä¸ªåŠç‚¸å¤©çš„åº“ã€‚ä½ çš„å¿ƒä¸­æ¿€åŠ¨ä¸‡åˆ†ï¼Œå‘å››ä¸€å®šè¦ä½¿ç”¨è¿™ä¸ªåº“ã€‚è¯´å¹²å°±å¹²ï¼Œæ‰“å¼€ Android Studioï¼Œåœ¨ builde.gradle é‡Œé¢æ·»åŠ ä¸Š 1compile &#x27;com.github.bumptech.glide:glide:3.6.1&#x27; ç„¶åå…¨å±€æœç´¢å›¾ç‰‡åŠ è½½çš„åœ°æ–¹ï¼Œå…¨éƒ¨æ¢æˆäº†ä¸‹é¢çš„ä»£ç ï¼š 12345Glide.with(mContext) .load(url) .placeholder(R.drawable.loading_spinner) .crossFade() .into(myImageView); åœ¨ç»è¿‡æ¼«é•¿çš„ç¼–è¯‘è¿‡ç¨‹ä¹‹åï¼Œå†æ¬¡æ‰“å¼€ APPï¼Œçœ‹åˆ°æœ‰ç€æ¸ç°æ•ˆæœçš„å›¾ç‰‡å‘ˆç°åœ¨ä½ çš„é¢å‰ï¼Œä½ ä¸ç¦å«é“ï¼šâ€œwocao,çœŸ TM å¸…ï¼ä¸ºä»€ä¹ˆæˆ‘ä»¥å‰æ²¡æœ‰å‘ç°å‘¢ï¼Ÿâ€ã€‚ ä¸è¿‡åœ¨ä½ ä½¿ç”¨äº†å‡ å¤©ä¹‹åä½ ä¼šå‘ç°ä¸€äº›é—®é¢˜ï¼š ä¸ºä»€ä¹ˆ æœ‰çš„å›¾ç‰‡ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™åªæ˜¾ç¤ºå ä½å›¾ï¼Œç¬¬äºŒæ¬¡æ‰æ˜¾ç¤ºæ­£å¸¸çš„å›¾ç‰‡å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆ æˆ‘æ€»ä¼šå¾—åˆ°ç±»ä¼¼ You cannot start a load for a destroyed activity è¿™æ ·çš„å¼‚å¸¸å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆ æˆ‘ä¸èƒ½ç»™åŠ è½½çš„å›¾ç‰‡ setTag()å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿè¿™ä¹ˆ NB çš„åº“ç«Ÿç„¶ä¼šæœ‰è¿™ä¹ˆå¤šçš„é—®é¢˜ã€‚æ²¡é”™ï¼Œè¿™å°±æ˜¯æˆ‘ä»Šå¤©è¦è®²çš„é‡ç‚¹ã€‚æ€ä¹ˆé¿å…ä¸Šé¢çš„é—®é¢˜å‘ç”Ÿã€‚ ä¸€äº›è§£å†³æ–¹æ¡ˆ1.å¦‚æœä½ åˆšå¥½ä½¿ç”¨äº†è¿™ä¸ªåœ†å½¢Imageview åº“æˆ–è€…å…¶ä»–çš„ä¸€äº›è‡ªå®šä¹‰çš„åœ†å½¢ Imageviewï¼Œè€Œä½ åˆåˆšå¥½è®¾ç½®äº†å ä½çš„è¯ï¼Œé‚£ä¹ˆï¼Œä½ å°±ä¼šé‡åˆ°ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚å¦‚ä½•è§£å†³å‘¢ï¼Ÿæ–¹æ¡ˆä¸€: ä¸è®¾ç½®å ä½ï¼›æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ Glide çš„ Transformation API è‡ªå®šä¹‰åœ†å½¢ Bitmap çš„è½¬æ¢ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªå·²æœ‰çš„ä¾‹å­ï¼›æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ä¸‹é¢çš„ä»£ç åŠ è½½å›¾ç‰‡ï¼š 123456789Glide.with(mContext) .load(url) .placeholder(R.drawable.loading_spinner) .into(new SimpleTarget&lt;Bitmap&gt;(width, height) &#123; @Override public void onResourceReady(Bitmap bitmap, GlideAnimation anim) &#123; // setImageBitmap(bitmap) on CircleImageView &#125; &#125;; 2.è‡³äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œè¯·è®°ä½ä¸€å¥è¯ï¼šä¸è¦å†éä¸»çº¿ç¨‹é‡Œé¢ä½¿ç”¨ Glide åŠ è½½å›¾ç‰‡ï¼Œå¦‚æœçœŸçš„ä½¿ç”¨äº†ï¼Œè¯·æŠŠ context å‚æ•°æ¢æˆ getApplicationContextã€‚æ›´å¤šçš„ç»†èŠ‚è¯·å‚è€ƒè¿™ä¸ª issueã€‚ 3.ä¸ºä»€ä¹ˆä¸èƒ½è®¾ç½® Tagï¼Œæ˜¯å› ä¸ºä½ ä½¿ç”¨çš„å§¿åŠ¿ä¸å¯¹å“¦ã€‚å¦‚ä½•ä¸º ImageView è®¾ç½® Tag å‘¢ï¼Ÿä¸”å¬æˆ‘ç»†ç»†é“æ¥ã€‚æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ setTag(int,object)æ–¹æ³•è®¾ç½® tag,å…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼šJava ä»£ç æ˜¯é…±ç´«çš„ï¼š 12345678Glide.with(context).load(urls.get(i).getUrl()).fitCenter().into(imageViewHolder.image); imageViewHolder.image.setTag(R.id.image_tag, i); imageViewHolder.image.setOnClickListener(new View.OnClickListener() &#123; @Override int position = (int) v.getTag(R.id.image_tag); Toast.makeText(context, urls.get(position).getWho(), Toast.LENGTH_SHORT).show(); &#125; &#125;); åŒæ—¶åœ¨ values æ–‡ä»¶å¤¹ä¸‹æ–°å»º ids.xmlï¼Œæ·»åŠ  1&lt;item name=&quot;image_tag&quot; type=&quot;id&quot;/&gt; å¤§åŠŸå‘Šæˆ! æ–¹æ¡ˆäºŒï¼šä» Glide çš„ 3.6.0 ä¹‹åï¼Œæ–°æ·»åŠ äº†å…¨å±€è®¾ç½®çš„æ–¹æ³•ã€‚å…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼šå…ˆå®ç° GlideMoudle æ¥å£ï¼Œå…¨å±€è®¾ç½® ViewTaget çš„ tagId: 1234567891011public class MyGlideMoudle implements GlideModule&#123; @Override public void applyOptions(Context context, GlideBuilder builder) &#123; ViewTarget.setTagId(R.id.glide_tag_id); &#125; @Override public void registerComponents(Context context, Glide glide) &#123; &#125;&#125; åŒæ ·ï¼Œä¹Ÿéœ€è¦åœ¨ ids.xml ä¸‹æ·»åŠ  id 1&lt;item name=&quot;glide_tag_id&quot; type=&quot;id&quot;/&gt; æœ€ååœ¨ AndroidManifest.xml æ–‡ä»¶é‡Œé¢æ·»åŠ  123&lt;meta-data android:name=&quot;com.yourpackagename.MyGlideMoudle&quot; android:value=&quot;GlideModule&quot; /&gt; åˆå¯ä»¥æ„‰å¿«çš„ç©è€äº†ï¼Œå˜»å˜»`(âˆ©_âˆ©)â€²ã€‚ æ–¹æ¡ˆä¸‰ï¼šå†™ä¸€ä¸ªç»§æ‰¿è‡ª ImageViewTaget çš„ç±»ï¼Œå¤å†™å®ƒçš„ get/setRequest æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425Glide.with(context).load(urls.get(i).getUrl()).fitCenter().into(new ImageViewTarget&lt;GlideDrawable&gt;(imageViewHolder.image) &#123; @Override protected void setResource(GlideDrawable resource) &#123; imageViewHolder.image.setImageDrawable(resource); &#125; @Override public void setRequest(Request request) &#123; imageViewHolder.image.setTag(i); imageViewHolder.image.setTag(R.id.glide_tag_id,request); &#125; @Override public Request getRequest() &#123; return (Request) imageViewHolder.image.getTag(R.id.glide_tag_id); &#125; &#125;); imageViewHolder.image.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; int position = (int) v.getTag(); Toast.makeText(context, urls.get(position).getWho(), Toast.LENGTH_SHORT).show(); &#125; &#125;); ä¸€äº›ä½¿ç”¨æŠ€å·§1.Glide.with(context).resumeRequests()å’Œ Glide.with(context).pauseRequests() å½“åˆ—è¡¨åœ¨æ»‘åŠ¨çš„æ—¶å€™ï¼Œè°ƒç”¨ pauseRequests()å–æ¶ˆè¯·æ±‚ï¼Œæ»‘åŠ¨åœæ­¢æ—¶ï¼Œè°ƒç”¨ resumeRequests()æ¢å¤è¯·æ±‚ã€‚è¿™æ ·æ˜¯ä¸æ˜¯ä¼šå¥½äº›å‘¢ï¼Ÿ 2.Glide.clear() å½“ä½ æƒ³æ¸…é™¤æ‰æ‰€æœ‰çš„å›¾ç‰‡åŠ è½½è¯·æ±‚æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥å¸®åŠ©åˆ°ä½ ã€‚ 3.ListPreloader å¦‚æœä½ æƒ³è®©åˆ—è¡¨é¢„åŠ è½½çš„è¯ï¼Œä¸å¦¨è¯•ä¸€ä¸‹ ListPreloader è¿™ä¸ªç±»ã€‚ ä¸€äº›åŸºäº Glide çš„ä¼˜ç§€åº“1.glide-transformations ä¸€ä¸ªåŸºäº Glide çš„ transformation åº“ï¼Œæ‹¥æœ‰è£å‰ªï¼Œç€è‰²ï¼Œæ¨¡ç³Šï¼Œæ»¤é•œç­‰å¤šç§è½¬æ¢æ•ˆæœï¼Œèµçš„ä¸è¡Œä¸è¡Œçš„~~ 2.GlidePalette ä¸€ä¸ªå¯ä»¥åœ¨ Glide åŠ è½½æ—¶å¾ˆæ–¹ä¾¿ä½¿ç”¨ Palette çš„åº“ã€‚","tags":[{"name":"Glide","slug":"Glide","permalink":"http://www.imzhiqiang.com/tags/Glide/"},{"name":"å›¾ç‰‡åŠ è½½åº“","slug":"å›¾ç‰‡åŠ è½½åº“","permalink":"http://www.imzhiqiang.com/tags/%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E5%BA%93/"}]},{"title":"Retrofitç³»åˆ—ä¹‹äºŒï¼šRetrofitçš„åŸºæœ¬èº«ä»½éªŒè¯ï¼ˆè¯‘ï¼‰","date":"2015-07-16T11:44:11.000Z","path":"2015/07/16/Retrofit-Basic-Authentication-on-Android/","text":"è¿™æ˜¯ Retrofit ç³»åˆ—æ–‡ç« çš„ç¬¬äºŒç¯‡ã€‚å°†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Retrofit å®Œæˆç”¨æˆ·å/é‚®ç®±å’Œå¯†ç çš„èº«ä»½éªŒè¯ã€‚ åœ¨å‰é¢çš„ç« èŠ‚é‡Œï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåˆå§‹ç‰ˆæœ¬çš„ API/HTTP è¯·æ±‚å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬ä¼šåœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ åŸºæœ¬çš„èº«ä»½éªŒè¯åŠŸèƒ½ã€‚ é›†æˆåŸºæœ¬çš„èº«ä»½éªŒè¯è®©æˆ‘ä»¬æ›´æ–°ä¸‹ ServiceGenerator ç±»ï¼Œåˆ›å»ºä¸€ä¸ªæ·»åŠ éªŒè¯çš„æ–¹æ³•ã€‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ˜¯åŸºäºä¸Šé¢çš„ç±»çš„ã€‚åŒæ—¶ä¹Ÿä¸ºä¸‹é¢ 1.9 ç‰ˆæœ¬çš„ä»£ç æ·»åŠ äº† 2.0 çš„ç¤ºä¾‹ã€‚å¦‚æœä½ ä¾èµ–äº Retrofit 2.0 ç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡ 1.9 çš„ä¾‹å­ï¼Œç›´æ¥çœ‹ç¬¬äºŒä¸ªä»£ç å—:) Retrofit 1.9123456789101112131415161718192021222324252627282930313233public class ServiceGenerator &#123; public static final String API_BASE_URL = &quot;http://your.api-base.url&quot;; private static RestAdapter.Builder builder = new RestAdapter.Builder() .setEndpoint(API_BASE_URL) .setClient(new OkClient(new OkHttpClient())); public static &lt;S&gt; S createService(Class&lt;S&gt; serviceClass) &#123; return createService(serviceClass, null, null); &#125; public static &lt;S&gt; S createService(Class&lt;S&gt; serviceClass, String username, String password) &#123; if (username != null &amp;&amp; password != null) &#123; // concatenate username and password with colon for authentication String credentials = username + &quot;:&quot; + password; // create Base64 encodet string final String basic = &quot;Basic &quot; + Base64.encodeToString(credentials.getBytes(), Base64.NO_WRAP); builder.setRequestInterceptor(new RequestInterceptor() &#123; @Override public void intercept(RequestFacade request) &#123; request.addHeader(&quot;Authorization&quot;, basic); request.addHeader(&quot;Acceppt&quot;, &quot;application/json&quot;); &#125; &#125;); &#125; RestAdapter adapter = builder.build(); return adapter.create(serviceClass); &#125;&#125; Retrofit 212345678910111213141516171819202122232425262728293031323334353637383940public class ServiceGenerator &#123; public static final String API_BASE_URL = &quot;http://your.api-base.url&quot;; private static OkHttpClient httpClient = new OkHttpClient(); private static Retrofit.Builder builder = new Retrofit.Builder() .baseUrl(API_BASE_URL) .addConverterFactory(GsonConverterFactory.create()); public static &lt;S&gt; S createService(Class&lt;S&gt; serviceClass) &#123; return createService(serviceClass, null, null); &#125; public static &lt;S&gt; S createService(Class&lt;S&gt; serviceClass, String username, String password) &#123; if (username != null &amp;&amp; password != null) &#123; String credentials = username + &quot;:&quot; + password; final String basic = &quot;Basic &quot; + Base64.encodeToString(credentials.getBytes(), Base64.NO_WRAP); httpClient.interceptors().add(new Interceptor() &#123; @Override public Response intercept(Interceptor.Chain chain) throws IOException &#123; Request original = chain.request(); Request.Builder requestBuilder = original.newBuilder() .header(&quot;Authorization&quot;, basic); .header(&quot;Accept&quot;, &quot;applicaton/json&quot;); .method(original.method(), original.body()); Request request = requestBuilder.build(); return chain.proceed(request); &#125; &#125;); &#125; Retrofit retrofit = builder.client(httpClient).build(); return retrofit.create(serviceClass); &#125;&#125; æ–°çš„æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼šç”¨æˆ·å å’Œ å¯†ç ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨é‚®ç®±æ¥ä»£æ›¿ç”¨æˆ·åã€‚ä¸åœ¨ç¬¬ä¸€ä¸ªæ–¹æ³•ä¸­åˆ›å»ºå®¢æˆ·ç«¯çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼šä½¿ç”¨ RestAdapter (Retrofit 2 ä¸­ä¸º Retrofit)ç±»è®¾ç½®åŸºæœ¬çš„ url å’Œ OkHttpClientã€‚ ä¸åŒçš„æ˜¯ï¼šæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªè¯·æ±‚æ‹¦æˆªå™¨ RequestInterceptor (Retrofit 2 ä¸­ä¸º Interceptor )æ¥è®¾ç½®åŸºç¡€ url Http è¯·æ±‚çš„å¤´ä¿¡æ¯ã€‚å¦‚æœæä¾›äº†ç”¨æˆ·åå’Œå¯†ç ï¼Œä¼šæ‰§è¡Œæ–°çš„æ–¹æ³•ã€‚å¦‚æœç”¨æˆ·åå’Œå¯†ç ä¸æ­£ç¡®æ—¶ï¼Œä¼šåˆ›å»ºç¬¬ä¸€ä¸ªæ–¹æ³•ä¸­çš„å®¢æˆ·ç«¯ã€‚è¿™æ˜¯æˆ‘ä»¬ç®€åŒ–ç¬¬ä¸€ä¸ªæ–¹æ³•çš„åŸå› ã€‚ åœ¨éªŒè¯éƒ¨åˆ†æˆ‘ä»¬å¿…é¡»è°ƒæ•´ç”¨æˆ·å/é‚®ç®±å’Œå¯†ç çš„æ ¼å¼ã€‚åŸºç¡€èº«ä»½éªŒè¯éœ€è¦ä¸€ä¸ªå†’å·è¿æ¥ä¸¤ä¸ªå€¼çš„å­—ç¬¦ä¸²ã€‚æ­¤å¤–ï¼Œæ–°åˆ›å»ºçš„å­—ç¬¦ä¸²å¿…é¡»ç»è¿‡ Base64 ç¼–ç ã€‚ å‡ ä¹ä»»ä½•ä¸€ä¸ª webservice å’Œ API çš„éªŒè¯éƒ½æ˜¯åœ¨ HTTP çš„è¯·æ±‚å¤´é‡Œé¢çš„ã€‚è¿™æ˜¯æˆ‘ä»¬åœ¨è¯·æ±‚å¤´é‡Œé¢è®¾ç½®ç¼–ç å€¼çš„åŸå› ã€‚ å¦‚æœä½ æƒ³æ¥æ”¶ç‰¹æ®Šæ ¼å¼çš„æœåŠ¡å™¨å“åº”æ—¶ï¼ŒAccent å¤´æ˜¯å¾ˆé‡è¦çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³æ¥æ”¶ JSON æ ¼å¼çš„å“åº”ï¼Œå› ä¸º Retrofit å’Œ Google çš„ GSON é…åˆä¼šå°† java å¯¹è±¡åºåˆ—åŒ–ä¸º JSON,åè¿‡æ¥ä¹Ÿå¯ä»¥ã€‚ ç”¨æ³•è°ƒç”¨æˆ‘ä»¬ä¹‹å‰å†™çš„ ServiceGenerator ç±»çš„æ–°æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢ä»£ç å®šä¹‰çš„ LoginServiceã€‚ Retrofit 1.91234public interface LoginService &#123; @POST(&quot;/login&quot;) User basicLogin();&#125; Retrofit 21234public interface LoginService &#123; @POST(&quot;/login&quot;) Call&lt;User&gt; basicLogin();&#125; ä¸Šé¢çš„æ¥å£åªåŒ…å«ä¸€ä¸ª baseLogin çš„æ–¹æ³•ã€‚è¯¥æ–¹æ³•è¿”å› User ç±»å‹ï¼Œæ²¡æœ‰ä»»ä½•çš„æŸ¥è¯¢å‚æ•°ã€‚ ç°åœ¨ä½ å¯ä»¥é€šè¿‡ç»™å®šçš„è¯ä¹¦ï¼ˆç”¨æˆ·åå’Œå¯†ç ï¼‰åˆ›å»ºä½ çš„ HTTP å®¢æˆ·ç«¯äº†ã€‚ Retrofit 1.9123LoginService loginService = ServiceGenerator .createService(LoginService.class, &quot;user&quot;, &quot;secretpassword&quot;);User user = loginService.login(); Retrofit 21234LoginService loginService = ServiceGenerator .createService(LoginService.class, &quot;user&quot;, &quot;secretpassword&quot;);Call&lt;User&gt; call = loginService.login();User user = call.execute().body(); ServiceGenerator çš„æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«éªŒè¯ä¿¡æ¯çš„ HTTP å®¢æˆ·ç«¯ã€‚ä¸€æ—¦ä½ è°ƒç”¨ loginService çš„ basicLogin æ–¹æ³•ï¼Œè¢«æä¾›çš„è¯ä¹¦å°†ä¼šè¢«è‡ªåŠ¨ä¼ é€’åˆ°ä½ å®šä¹‰çš„åŸºç¡€ url äº†ã€‚ æ¥ä¸‹æ¥æ˜¯ä»€ä¹ˆä¸‹ç¯‡æ–‡ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Retrofit å®ç° OAuthã€‚ åŸæ–‡åœ°å€ï¼šhttps://futurestud.io/blog/android-basic-authentication-with-retrofit/","tags":[{"name":"Retrofit","slug":"Retrofit","permalink":"http://www.imzhiqiang.com/tags/Retrofit/"},{"name":"èº«ä»½éªŒè¯","slug":"èº«ä»½éªŒè¯","permalink":"http://www.imzhiqiang.com/tags/%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81/"},{"name":"Authentication","slug":"Authentication","permalink":"http://www.imzhiqiang.com/tags/Authentication/"}]},{"title":"Retrofitç³»åˆ—ä¹‹ä¸€ï¼šå¼€å§‹åˆ›å»ºRetrofitå®¢æˆ·ç«¯ï¼ˆè¯‘ï¼‰","date":"2015-07-09T15:07:16.000Z","path":"2015/07/09/Retrofit-Getting-Started-and-Create-an-Android-Client/","text":"è¿™æ˜¯ Retrofit ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ã€‚è¯¥ç³»åˆ—é€šè¿‡é€šè¿‡å‡ ä¸ªç”¨ä¾‹æ¥æ¢è®¨ Retrofit çš„åŠŸèƒ½å’Œæ‰©å±•ã€‚ è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ Retrofit çš„åŸºç¡€çŸ¥è¯†æ¥åˆ›å»ºä¸€ä¸ª API æˆ–è€… Http è¯·æ±‚çš„ Android å®¢æˆ·ç«¯ã€‚ ç„¶è€Œï¼Œè¿™ç¯‡æ–‡ç« å¹¶ä¸åŒ…å«å¤ªå¤šå…³äº Retrofit å’Œå¦‚ä½•å¼€å§‹ä½¿ç”¨å¥¹çš„ä¿¡æ¯ï¼Œå¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œè¯·è®¿é—®è¯¥é¡¹ç›®çš„ä¸»é¡µã€‚ ä»€ä¹ˆæ˜¯ Retrofitæ® Retrofit çš„å®˜æ–¹é¡µé¢æè¿°ï¼Œå¥¹æ˜¯ ä¸€ä¸ªç±»å‹å®‰å…¨çš„ Android æˆ– Java çš„ REST å®¢æˆ·ç«¯ ä½ å¯ä»¥ä½¿ç”¨æ³¨è§£æ¥æè¿° Http è¯·æ±‚ï¼ŒURL å‚æ•°æ›¿æ¢ï¼ŒæŸ¥è¯¢å‚æ•°æ”¯æŒã€‚è¿™äº›éƒ½æ˜¯é»˜è®¤é›†æˆçš„ã€‚æ­¤å¤–ï¼Œå¥¹è¿˜æä¾›äº†å¤šç§å¤šæ ·çš„è¯·æ±‚ä½“å’Œæ–‡ä»¶ä¸Šä¼ ã€‚ å¦‚ä½•å£°æ˜(API)è¯·æ±‚è¯·è®¿é—® Retrofit çš„ä¸»é¡µé˜…è¯»å¥¹çš„ API æ–‡æ¡£è¯´æ˜ï¼Œäº†è§£å¦‚ä½•å‘èµ·è¯·æ±‚ã€‚é€šè¿‡æ¸…æ™°çš„ä»£ç ç¤ºä¾‹ä½ ä¼šè·å–åˆ°æ‰€æœ‰çš„é‡è¦ä¿¡æ¯ã€‚ å‡†å¤‡ä½ çš„ Android å·¥ç¨‹ç°åœ¨è®©æˆ‘ä»¬çš„æ‰‹å›åˆ°é”®ç›˜å¼€å§‹å¹²æ´»ã€‚å¦‚æœä½ å·²ç»åˆ›å»ºå¥½å·¥ç¨‹ï¼Œè¯·ç›´æ¥çœ‹ä¸‹ä¸€æ®µã€‚ä¸ç„¶ä½ å°±åœ¨ä½ å–œçˆ±çš„ IDE é‡Œé¢æ–°å»ºä¸€ä¸ªé¡¹ç›®ã€‚æˆ‘ä»¬æ›´å€¾å‘äº Gradle çš„æ„å»ºç³»ç»Ÿï¼Œå¦‚æœä½ ä½¿ç”¨ Maven ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ å£°æ˜ä¾èµ–ï¼šGradle æˆ–è€… Mavenç°åœ¨è®©æˆ‘ä»¬ä¸ºè‡ªå·±çš„å·¥ç¨‹æ·»åŠ  Retrofit çš„ä¾èµ–ã€‚é€‰æ‹©ä½ çš„æ„å»ºç³»ç»Ÿåœ¨ pom.xml æˆ–è€… build.gradle é‡Œé¢å£°æ˜ Retrofit çš„ä¾èµ–ã€‚å½“æ„å»ºç³»ç»Ÿå¼€å§‹ç¼–è¯‘ä½ çš„ä»£ç æ—¶ï¼Œä»–ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶ä¸ºå·¥ç¨‹æ·»åŠ ä¾èµ–åº“ã€‚æˆ‘ä»¬ä¹Ÿå€¾å‘äºæŠŠ Retrofit å’Œ OkHTTP ç»“åˆä½¿ç”¨ã€‚ Retrofit 1.9pom.xml 12345678910&lt;dependency&gt; &lt;groupId&gt;com.squareup.retrofit&lt;/groupId&gt; &lt;artifactId&gt;retrofit&lt;/artifactId&gt; &lt;version&gt;1.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.squareup.okhttp&lt;/groupId&gt; &lt;artifactId&gt;okhttp&lt;/artifactId&gt; &lt;version&gt;2.4.0&lt;/version&gt;&lt;/dependency&gt; build.gradle 1234dependencies &#123; compile &#39;com.squareup.retrofit:retrofit:1.9.0&#39; compile &#39;com.squareup.okhttp:okhttp:2.4.0&#39;&#125; Retrofit 2å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Retrofit 2 è¯·ä½¿ç”¨ä¸‹é¢çš„ä¾èµ–ã€‚ pom.xml 12345&lt;dependency&gt; &lt;groupId&gt;com.squareup.retrofit&lt;/groupId&gt; &lt;artifactId&gt;retrofit&lt;/artifactId&gt; &lt;version&gt;2.2.0-beta2&lt;/version&gt;&lt;/dependency&gt; build.gradle 1234dependencies &#123; &#x2F;&#x2F; Retrofit &amp; OkHttp compile &#39;com.squareup.retrofit:retrofit:2.0.0-beta2&#39;&#125; Retrofit 2 ç°åœ¨å·²ç»é»˜è®¤ä½¿ç”¨ OkHttp ä½œä¸ºç½‘ç»œå±‚ã€‚ä½ ä¸éœ€è¦ä¸ºä½ çš„å·¥ç¨‹æ·»åŠ  OkHttp çš„ä¾èµ–äº†ï¼Œé™¤éä½ éœ€è¦ä¸€ä¸ªç‰¹å®šçš„ç‰ˆæœ¬ã€‚ ç°åœ¨ä½ çš„å·¥ç¨‹å·²ç»é›†æˆäº† Retrofitï¼Œè®©æˆ‘ä»¬åˆ›é€ ä¸€ä¸ªæŒä¹…çš„ Android API/HTTP å®¢æˆ·ç«¯ã€‚ å¯æŒç»­çš„ Android å®¢æˆ·ç«¯åœ¨ç ”ç©¶å·²å­˜åœ¨çš„ Retrofit çš„å®¢æˆ·ç«¯æ—¶ï¼ŒBart Kiers çš„ä»“åº“å‡ºç°äº†ã€‚äº‹å®ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªä½¿ç”¨ Retrofit çš„ Oauth éªŒè¯å®ä¾‹ã€‚å®ƒä¸ºä¸€ä¸ªå¯æŒç»­çš„ Android å®¢æˆ·ç«¯æä¾›äº†å¿…è¦çš„åŸºæœ¬åŸç†ã€‚è¿™æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆä½¿ç”¨å®ƒä½œä¸ºä¸€ä¸ªç¨³å®šçš„åŸºç¡€ã€‚åœ¨æœªæ¥çš„åšæ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šè¿›ä¸€æ­¥æ‰©å±•éªŒè¯åŠŸèƒ½ã€‚ ä¸‹é¢çš„ç±»å®šä¹‰äº†æˆ‘ä»¬ Android å®¢æˆ·ç«¯çš„åŸºç¡€ï¼šServiceGenerator Service GeneratorServiceGenerator æ˜¯æˆ‘ä»¬ API/HTTP å®¢æˆ·ç«¯çš„æ ¸å¿ƒ.ç°åœ¨, å¥¹ä»…ä»…å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ä¸ºç»™å®šçš„ç±»æˆ–è€…æ¥å£åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ REST adapterã€‚è¿™é‡Œæ˜¯ä»£ç ï¼š Retrofit 1.91234567891011121314public class ServiceGenerator &#123; public static final String API_BASE_URL = &quot;http://your.api-base.url&quot;; private static RestAdapter.Builder builder = new RestAdapter.Builder() .setEndpoint(API_BASE_URL) .setClient(new OkClient(new OkHttpClient())); public static &lt;S&gt; S createService(Class&lt;S&gt; serviceClass) &#123; RestAdapter adapter = builder.build(); return adapter.create(serviceClass); &#125;&#125; Retrofit 212345678910111213141516public class ServiceGenerator &#123; public static final String API_BASE_URL = &quot;http://your.api-base.url&quot;; private static OkHttpClient httpClient = new OkHttpClient(); private static Retrofit.Builder builder = new Retrofit.Builder() .baseUrl(API_BASE_URL) .addConverterFactory(GsonConverterFactory.create()); public static &lt;S&gt; S createService(Class&lt;S&gt; serviceClass) &#123; Retrofit retrofit = builder.client(httpClient).build(); return retrofit.create(serviceClass); &#125;&#125; ServiceGenerator ç±»ä½¿ç”¨ Retrofit çš„ RestAdapter-Builder æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ REST å®¢æˆ·ç«¯é€šè¿‡ä¸€ä¸ªè¢«ç»™å®šåŸºç¡€ url çš„ APIã€‚ä¾‹å¦‚,GitHub çš„ API åŸºç¡€ url æ˜¯ https://developer.github.com/v3/ ã€‚serviceClass å®šä¹‰äº† API è¯·æ±‚çš„ç±»æˆ–è€…æ¥å£ã€‚ä¸‹é¢å±•ç¤ºäº† Retrofit çš„ç”¨æ³•å’Œå¦‚ä½•å®šä¹‰ä¸€ä¸ªå®ä¾‹å®¢æˆ·ç«¯ã€‚ JSON MappingRetrofit 1.9 é»˜è®¤ä½¿ç”¨ Google çš„ Gsonã€‚ä½ æ‰€è¦åšçš„å°±æ˜¯å®šä¹‰ä½ çš„å“åº”å¯¹è±¡ç±»ï¼Œå“åº”ä¼šè‡ªåŠ¨æ˜ å°„ä¸º Java å¯¹è±¡ã€‚ å½“ä½¿ç”¨ Retrofit 2 æ—¶ï¼Œä½ éœ€è¦ä¸º Retrofit å¯¹è±¡æ·»åŠ ä¸€ä¸ª converterã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆä¼šé›†æˆ GSON åˆ°åœ¨ Retrofit æ„å»ºè¿‡ç¨‹ä¸­è¦è°ƒç”¨ .addConverterFactory(GsonConverterFactory.create()) çš„åŸå› äº†ã€‚ ä½¿ç”¨ Retrofitå¥½, ç°åœ¨è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªä» github è¯·æ±‚æ•°æ®çš„å®¢æˆ·ç«¯å®ä¾‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶å®šä¹‰ä¸€ä¸ªæ‰€éœ€çš„æ–¹æ³•ã€‚ GitHub å®¢æˆ·ç«¯ä¸‹é¢çš„ä»£ç å®šä¹‰äº† GitHubClient å’Œä¸€ä¸ªè¯·æ±‚æŸä»“åº“è´¡çŒ®è€…åˆ—è¡¨çš„æ–¹æ³•ã€‚å®ƒè¯´æ˜äº† Retrofit å‚æ•°æ›¿ä»£åŠŸèƒ½çš„ç”¨æ³•ã€‚ï¼ˆå½“è°ƒç”¨æ–¹æ³•æ—¶ï¼ŒæŒ‡å®šè·¯å¾„ä¸­çš„ owner å’Œ repo å°†ä¼šè¢«æ›¿æ¢ä¸ºç»™å®šçš„å˜é‡ï¼‰ Retrofit 1.91234567public interface GitHubClient &#123; @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;) List&lt;Contributor&gt; contributors( @Path(&quot;owner&quot;) String owner, @Path(&quot;repo&quot;) String repo );&#125; Retrofit 21234567public interface GitHubClient &#123; @GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;) Call&lt;List&lt;Contributor&gt;&gt; contributors( @Path(&quot;owner&quot;) String owner, @Path(&quot;repo&quot;) String repo );&#125; è¿™æ˜¯ Contributor ç±»çš„å®šä¹‰.è¯¥ç±»åŒ…å«äº†å“åº”æ•°æ®æ˜ å°„æ‰€éœ€çš„å±æ€§ã€‚ 1234static class Contributor &#123; String login; int contributions; &#125; å…³äºå‰é¢æåˆ°çš„ JSON æ˜ å°„ï¼šGitHubClient å®šä¹‰äº†ä¸€ä¸ªåä¸º contributors è¿”å›ç±»å‹ä¸º List&lt;Contributor&gt; çš„æ–¹æ³•ã€‚Retrofit ç¡®ä¿æœåŠ¡å™¨å“åº”å¯ä»¥æ­£ç¡®çš„å¾—åˆ°æ˜ å°„ã€‚ï¼ˆåœ¨å“åº”ä¸ç»™å®šçš„ç±»åŒ¹é…æ—¶ï¼‰ API å®ä¾‹è¯·æ±‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µè¯´æ˜äº† ServiceGenerator å®ä¾‹åŒ–ä½ å®¢æˆ·ç«¯çš„ç”¨æ³•ã€‚Github å®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨æ–¹æ³•æ¥è·å–ä»“åº“è´¡çŒ®è€…çš„åˆ—è¡¨ã€‚è¿™æ®µä»£ç æ˜¯ä¸€ä¸ª Retrofit GitHub å®¢æˆ·ç«¯ç¤ºä¾‹çš„ä¿®æ”¹ç‰ˆã€‚ ä½ éœ€è¦ä¸º ServiceGenerator æ‰‹åŠ¨å®šä¹‰ä¸€ä¸ªåŸºæœ¬çš„ url https://developer.github.com/v3/ ã€‚ Retrofit 1.912345678910111213public static void main(String... args) &#123; // Create a very simple REST adapter which points the GitHub API endpoint. GitHubClient client = ServiceGenerator.createService(GitHubClient.class); // Fetch and print a list of the contributors to this library. List&lt;Contributor&gt; contributors = client.contributors(&quot;fs_opensource&quot;, &quot;android-boilerplate&quot;); for (Contributor contributor : contributors) &#123; System.out.println( contributor.login + &quot; (&quot; + contributor.contributions + &quot;)&quot;); &#125;&#125; Retrofit 2123456789101112131415public static void main(String... args) &#123; // Create a very simple REST adapter which points the GitHub API endpoint. GitHubClient client = ServiceGenerator.createService(GitHubClient.class); // Fetch and print a list of the contributors to this library. Call&lt;List&lt;Contributor&gt;&gt; call = client.contributors(&quot;fs_opensource&quot;, &quot;android-boilerplate&quot;); List&lt;Contributor&gt; contributors = call.execute().body(); for (Contributor contributor : contributors) &#123; System.out.println( contributor.login + &quot; (&quot; + contributor.contributions + &quot;)&quot;); &#125;&#125; æ¥ä¸‹æ¥æ˜¯ä»€ä¹ˆä¸‹ç¯‡æ–‡ç« å°†é˜è¿°å¦‚ä½•ä½¿ç”¨ Retrofit å®ç°ä¸€ä¸ªåŸºæœ¬éªŒè¯ã€‚ å¾ˆé«˜å…´æ‚¨å¯ä»¥é˜…è¯» Retrofit ç³»åˆ—çš„ç¬¬ä¸€ç¯‡æ–‡ç« :) åŸæ–‡åœ°å€ï¼šhttps://futurestud.io/blog/retrofit-getting-started-and-android-client/","tags":[{"name":"Retrofit","slug":"Retrofit","permalink":"http://www.imzhiqiang.com/tags/Retrofit/"},{"name":"REST","slug":"REST","permalink":"http://www.imzhiqiang.com/tags/REST/"},{"name":"HTTPè¯·æ±‚","slug":"HTTPè¯·æ±‚","permalink":"http://www.imzhiqiang.com/tags/HTTP%E8%AF%B7%E6%B1%82/"}]},{"title":"HelloWorld","date":"2015-06-20T09:45:18.000Z","path":"2015/06/20/HelloWorld/","text":"ç«¯åˆèŠ‚çªç„¶æƒ³ç”¨ Github Pages æ­ä¸€ä¸ªè‡ªå·±çš„åšå®¢ã€‚æŠ˜è…¾äº†ä¸€å¤©ï¼Œç»ˆäºæå®šäº†ã€‚æ„Ÿè°¢ Githubï¼Œæä¾›äº†ä¸€ä¸ªå…è´¹çš„ç©ºé—´ï¼›æ„Ÿè°¢ hexo çš„åˆ›é€ è€…ï¼Œå¸®æˆ‘è§£å†³äº†å¾ˆå¤šå¤´ç–¼çš„äº‹æƒ…ï¼›æ„Ÿè°¢ç½‘ä¸Šçš„å„è·¯å¤§ç¥ï¼Œè®©æˆ‘ä¸€è·¯æŠ«è†æ–©æ£˜ï¼Œæœ€åæˆåŠŸæ­å»ºåšå®¢ã€‚ ä»¥åè¿™å°±æ˜¯é¢çš„å°å¤©åœ°äº†ï¼Œå…ˆæ¥ç¯‡ HelloWorldï¼Œç„¶åå®‰å®‰é™é™åœ°åšè‡ªå·±çš„ç å†œå§ï¼ æœ€åæ„Ÿè°¢é»å°è…¾åŒå­¦çš„ Yilia ä¸»é¢˜ï¼Œæˆ‘å¾ˆå–œæ¬¢ï¼","tags":[{"name":"åšå®¢","slug":"åšå®¢","permalink":"http://www.imzhiqiang.com/tags/%E5%8D%9A%E5%AE%A2/"},{"name":"hexo","slug":"hexo","permalink":"http://www.imzhiqiang.com/tags/hexo/"},{"name":"å¤„å¥³ç¯‡","slug":"å¤„å¥³ç¯‡","permalink":"http://www.imzhiqiang.com/tags/%E5%A4%84%E5%A5%B3%E7%AF%87/"},{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://www.imzhiqiang.com/tags/%E9%9A%8F%E7%AC%94/"}]}]